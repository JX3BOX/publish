(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-476a7a24"],{6962:function(t,e,s){"use strict";s("dd68")},"6c2b":function(t,e,s){"use strict";s.d(e,"b",(function(){return a})),s.d(e,"a",(function(){return n})),s.d(e,"c",(function(){return o})),s.d(e,"e",(function(){return c})),s.d(e,"d",(function(){return r}));var i=s("41cb"),l=s("4328");function a(){return Object(i.c)()({method:"GET",url:"/api/post/collection/legal_tags"})}function n(t){return Object(i.c)()({method:"GET",url:"/api/post/collection/".concat(t)})}function o(t){return Object(i.c)()({method:"GET",url:"/api/my/post/collections",params:t})}function c(t){return Object(i.c)()({method:"POST",url:"/api/post/collection",data:l.stringify({action:t.id?"update":"create",collection:t})})}function r(t){return t?Object(i.c)()({method:"PUT",url:"/api/post/collection/remove",data:l.stringify({id:t})}):null}},"6d29":function(t,e,s){},b13e:function(t,e,s){"use strict";s("99af");var i=s("65c2"),l=s("85e4"),a=i.__server+"upload",n={name:"post_banner",props:["data"],data:function(){return{banner:this.data,url:a}},model:{prop:"data",event:"update"},watch:{data:function(t){this.banner=t},banner:function(t){this.$emit("update",t)}},methods:{done:function(t,e){this.banner=t.data.list[0]},fail:function(t,e,s){try{var i=JSON.parse(t.message);this.$message.error("[".concat(i.code,"]").concat(i.msg))}catch(t){this.$message.error("网络请求异常")}},clearBanner:function(){this.banner=""}},filters:{showBanner:l.showBanner}},o=(s("6962"),s("2877")),c=Object(o.a)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"m-publish-banner"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("海报")]),s("el-alert",{staticClass:"u-tip",attrs:{title:"首页海报尺寸1100*300，非必选，部分栏目不会展示海报，分享功能将使用该图作为预览图",type:"info","show-icon":""}}),s("el-upload",{staticClass:"avatar-uploader",attrs:{action:t.url,"show-file-list":!1,"on-success":t.done,"on-error":t.fail,"with-credentials":"",accept:"image/jpg,image/jpeg,image/gif,image/png,image/bmp"}},[t.banner?s("img",{attrs:{src:t._f("showBanner")(t.banner)}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),s("el-button",{staticClass:"u-remove",attrs:{type:"info",size:"mini",icon:"el-icon-circle-close"},on:{click:t.clearBanner}},[t._v("移除海报")])],1)}),[],!1,null,null,null);e.a=c.exports},dd68:function(t,e,s){},ef77:function(t,e,s){"use strict";var i={name:"publish_header",props:["name"],data:function(){return{}},computed:{},methods:{goBack:function(){this.$router.push("/")}},mounted:function(){},components:{}},l=s("2877"),a=Object(l.a)(i,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"m-publish-header"},[e("el-page-header",{attrs:{content:this.name},on:{back:this.goBack}}),this._t("default")],2)}),[],!1,null,null,null);e.a=a.exports},f107:function(t,e,s){"use strict";s("6d29")},f1e8:function(t,e,s){"use strict";s.r(e);var i=s("b85c"),l=(s("ac1f"),s("1276"),s("d3b7"),s("65c2")),a=s("221a"),n=s("47b9"),o=s("ef77"),c=s("b13e"),r=s("b76a"),u=s.n(r),p=s("6c2b"),d=s("29c2"),m=(s("4328"),s("2ef0"),{name:"item",props:[],data:function(){var t=Object.assign(l.__postType,l.__otherType);return t.custom="自定义",delete t.cj,{source_types:t,public:n.a,collection:{id:"",title:"",public:1,image:"",description:"",tags:[],posts:[]},tag:"",legal_tags:null,show_description:!1,processing:!1}},mounted:function(){var t=this;this.collection.posts.length||this.add_posts_item(),this.$route.params.collection_id&&Object(p.a)(this.$route.params.collection_id).then((function(e){if(200===(e=e.data).code){var s=e.data.collection;if(s){for(var i in s.posts){var l=s.posts[i];s.posts[i].posts="custom"===l.type?null:[{id:l.id,title:l.title}]}t.collection=s}else t.$message({message:"该剑三小册已被删除或无权限访问",type:"warning"})}}))},methods:{tags_search:function(t,e){var s=this;null===this.legal_tags?Object(p.b)().then((function(i){i=i.data,s.legal_tags=200===i.code?i.data.tags:[],e(s.tags_filters(t))})):e(this.tags_filters(t))},tags_filters:function(t){var e,s=[],l=Object(i.a)(this.legal_tags);try{for(l.s();!(e=l.n()).done;){var a=e.value;a.split(t).length>1&&s.push({value:a})}}catch(t){l.e(t)}finally{l.f()}return s},title_fill:function(t,e){var s=e.posts[t];e.title=s&&s.title?s.title:""},add_posts_item:function(){this.collection.posts.push({title:"",type:"",id:"",url:"",posts:null})},search_handle:function(t,e){null===t&&(e.id=t=""),Object(d.b)(e.type,{public:1,keyword:t}).then((function(t){200===(t=t.data).code&&(e.posts=t.data.posts)}))},submit:function(){var t=this;this.$confirm("确定提交剑三小册信息？","提示",{type:"info"}).then((function(){var e=JSON.parse(JSON.stringify(t.collection));if(e.posts.length){for(var s in e.posts)delete e.posts[s].posts;e.posts=JSON.stringify(e.posts),t.processing=!0,Object(p.e)(e).then((function(e){200===(e=e.data).code?(t.$message({message:e.message,type:"success"}),setTimeout((function(){t.$router.push({name:"bucket",params:{type:"collection"}})}),500)):t.$message({message:"".concat(e.message),type:"warning"})})).finally((function(){t.processing=!1}))}else t.$message({message:"要添加剑三小册内文章哦",type:"warning"})}))}},components:{Tinymce:a.a,draggable:u.a,"publish-header":o.a,"publish-banner":c.a}}),h=(s("f107"),s("2877")),f=Object(h.a)(m,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"m-publish-box"},[s("publish-header",{attrs:{name:"文集小册",localDraft:!1}},[t._t("header")],2),s("el-form",{staticClass:"m-publish-collection",attrs:{"label-position":"left"}},[s("div",{staticClass:"m-publish-title"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("标题")]),s("el-input",{attrs:{placeholder:"请输入小册标题",maxlength:"30","show-word-limit":""},model:{value:t.collection.title,callback:function(e){t.$set(t.collection,"title",e)},expression:"collection.title"}})],1),s("div",{staticClass:"m-publish-primary"},[s("div",{staticClass:"m-publish-primary-block"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("可见性")]),s("el-radio",{attrs:{label:this.public.PUBLIC},model:{value:t.collection.public,callback:function(e){t.$set(t.collection,"public",t._n(e))},expression:"collection.public"}},[t._v("公开")]),s("el-radio",{attrs:{label:this.public.PRIVATE},model:{value:t.collection.public,callback:function(e){t.$set(t.collection,"public",t._n(e))},expression:"collection.public"}},[t._v("私有")])],1),s("div",{staticClass:"m-publish-primary-block"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("封面图")]),s("publish-banner",{model:{value:t.collection.image,callback:function(e){t.$set(t.collection,"image",e)},expression:"collection.image"}})],1),s("div",{staticClass:"m-publish-primary-block m-publish-collection-posts"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("内容")]),t.collection.posts&&t.collection.posts.length?s("draggable",{staticClass:"m-list-style",attrs:{tag:"ul",list:t.collection.posts,handle:".u-move"}},t._l(t.collection.posts,(function(e,i){return s("li",{key:i,staticClass:"c-posts-item"},[s("i",{staticClass:"u-move el-icon-more"}),s("i",{staticClass:"u-delete el-icon-close",on:{click:function(e){return t.collection.posts.splice(i,1)}}}),s("el-row",{staticClass:"m-posts-item",attrs:{gutter:10}},[s("el-col",{staticClass:"u-collection-type",attrs:{span:4}},[s("el-select",{staticClass:"u-item-key",attrs:{placeholder:"请选择文章类型"},on:{change:function(){t.search_handle(null,e),e.url=e.title=""}},model:{value:e.type,callback:function(s){t.$set(e,"type",s)},expression:"item.type"}},t._l(t.source_types,(function(t,e){return s("el-option",{key:e,attrs:{label:t,value:e}})})),1)],1),s("el-col",{staticClass:"u-collection-id",attrs:{span:8}},["custom"!==e.type?s("el-select",{staticClass:"u-item-value",attrs:{filterable:"",remote:"",placeholder:"通过输入文章标题进行搜索","remote-method":function(s){t.search_handle(s,e)}},on:{change:function(s){t.title_fill(s,e)}},model:{value:e.id,callback:function(s){t.$set(e,"id",s)},expression:"item.id"}},[t._l(e.posts,(function(e){return[e.id&&e.title?s("el-option",{key:e.id,attrs:{value:e.id,label:e.title}}):t._e()]}))],2):s("el-input",{staticClass:"u-item-value",attrs:{placeholder:"请输入完整网页链接（需以HTTP或HTTPS开头）"},model:{value:e.url,callback:function(s){t.$set(e,"url",s)},expression:"item.url"}})],1),e.url?s("el-col",{staticClass:"u-collection-url",attrs:{span:12}},[s("el-input",{attrs:{placeholder:"请输入自定义标题"},model:{value:e.title,callback:function(s){t.$set(e,"title",s)},expression:"item.title"}})],1):t._e()],1)],1)})),0):s("div",{staticClass:"u-posts-items-empty"},[t._v("暂无文章信息，请进行文章添加")]),s("div",{staticClass:"u-posts-add",on:{click:t.add_posts_item}},[s("i",{staticClass:"el-icon-plus"}),s("span",[t._v("添加文章")])])],1),s("div",{staticClass:"m-publish-primary-block m-publish-description"},[s("el-divider",{attrs:{"content-position":"left"},on:{click:function(e){t.show_description=!t.show_description}}},[t._v("描述（选填）")]),t.show_description?t._e():s("span",{staticClass:"u-show",on:{click:function(e){t.show_description=!0}}},[t._v("▼ 展开")]),t.show_description?s("span",{staticClass:"u-hide",on:{click:function(e){t.show_description=!1}}},[t._v("▲ 收起")]):t._e(),s("Tinymce",{directives:[{name:"show",rawName:"v-show",value:t.show_description,expression:"show_description"}],attrs:{attachmentEnable:!0,resourceEnable:!0,height:300},model:{value:t.collection.description,callback:function(e){t.$set(t.collection,"description",e)},expression:"collection.description"}})],1),s("div",{staticClass:"m-publish-primary-block m-publish-tags"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("标签（选填）")]),s("ul",{staticClass:"m-list-style"},t._l(t.collection.tags,(function(e,i){return s("li",{key:i,staticClass:"m-tag"},[s("span",{domProps:{textContent:t._s(e)}}),s("i",{staticClass:"el-icon-close",on:{click:function(e){return t.collection.tags.splice(i,1)}}})])})),0),t.collection.tags.length<5?s("div",{staticClass:"m-tag-add"},[s("el-autocomplete",{staticClass:"u-tag-add-value",attrs:{placeholder:"请输入标签（最多为5个）","fetch-suggestions":t.tags_search},model:{value:t.tag,callback:function(e){t.tag=e},expression:"tag"}}),s("el-button",{staticClass:"u-tag-add",on:{click:function(){t.tag&&t.collection.tags.push(t.tag),t.tag=""}}},[s("i",{staticClass:"el-icon-plus"})])],1):t._e()],1)]),s("el-form-item",[s("el-button",{staticClass:"m-publish-collection-publish u-publish",attrs:{icon:"el-icon-s-promotion",type:"primary",loading:t.processing},on:{click:t.submit}},[t._v("提交剑三小册")])],1)],1)],1)}),[],!1,null,"3ac1aa8a",null);e.default=f.exports}}]);
//# sourceMappingURL=chunk-476a7a24.f47f4b5c.js.map
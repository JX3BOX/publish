{"version":3,"sources":["webpack:///./src/post/item.vue","webpack:///./src/post/item.vue?1af2","webpack:///src/post/item.vue","webpack:///./src/post/item.vue?9161","webpack:///./src/components/publish_header.vue?4823","webpack:///./src/service/item.js","webpack:///./src/post/item.vue?97ab","webpack:///./src/components/publish_header.vue?6f8c","webpack:///src/components/publish_header.vue","webpack:///./src/components/publish_header.vue?3a87","webpack:///./src/components/publish_header.vue"],"names":["name","data","options","sources","post","id","content","source_id","level","remark","loading","processing","compatible","latest","current","computed","client","$store","state","_this$$route$query","$route","query","post_id","isLatest","_this$current","_this$current$post","_this$latest","_this$latest$post","methods","toPublish","_this","String","user_nickname","User","getInfo","_data","pick","wiki","update","_objectSpread","then","$message","message","type","setTimeout","$router","push","params","finally","icon_url_filter","icon_id","iconLink","search_handle","_this2","keyword","arguments","length","undefined","search_items","res","loadData","_this3","get","item","source","uniqBy","loadDataByPostId","_this4","getById","loadLatest","_this5","getLink","getLatest","_this$latest$post2","created","watch","handler","_this6","console","log","components","header","Tinymce","component","_vm","this","_c","_self","staticClass","attrs","_t","_v","model","value","callback","$$v","$set","expression","_l","key","Name","IconID","domProps","_s","scopedSlots","_u","fn","on","_e","proxy","fields","is_equip","limit","$node","searchItems","get_item","item_id","concat","props","goBack","window","history","go","mounted"],"mappings":"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","file":"js/chunk-429bdc1e.ec78753d.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-publish-box\"},[_c('publish-header',{attrs:{\"name\":\"物品百科\"}},[_vm._t(\"header\")],2),_c('el-form',{staticClass:\"m-publish-post\"},[_c('div',{staticClass:\"m-publish-source\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"选择物品 *\")]),_c('el-select',{staticClass:\"u-source-id\",attrs:{\"filterable\":\"\",\"remote\":\"\",\"disabled\":!!_vm.post.id,\"placeholder\":\"输入物品名称/物品描述并按『回车』进行搜索\",\"remote-method\":_vm.search_handle,\"loading\":_vm.options.loading},model:{value:(_vm.post.source_id),callback:function ($$v) {_vm.$set(_vm.post, \"source_id\", $$v)},expression:\"post.source_id\"}},_vm._l((_vm.options.sources),function(item){return _c('el-option',{key:item.id,attrs:{\"label\":item.Name,\"value\":item.id}},[_c('div',{staticClass:\"m-selector-item\"},[_c('img',{staticClass:\"u-icon\",attrs:{\"src\":_vm.icon_url_filter(item.IconID),\"alt\":item.Name}}),_c('span',{staticClass:\"u-name\",domProps:{\"textContent\":_vm._s(item.Name)}})])])}),1)],1),_c('div',{staticClass:\"m-publish-level\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"综合难度 *\")]),_c('el-rate',{staticClass:\"u-level\",model:{value:(_vm.post.level),callback:function ($$v) {_vm.$set(_vm.post, \"level\", $$v)},expression:\"post.level\"}})],1),_c('div',{staticClass:\"m-publish-remark\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"修订说明 *\")]),_c('el-input',{attrs:{\"placeholder\":\"请简单描述一下本次修订的说明\"},model:{value:(_vm.post.remark),callback:function ($$v) {_vm.$set(_vm.post, \"remark\", $$v)},expression:\"post.remark\"}})],1),_c('div',{staticClass:\"m-publish-content\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"攻略正文 *\")]),_c('Tinymce',{attrs:{\"attachmentEnable\":true,\"resourceEnable\":true,\"height\":400},model:{value:(_vm.post.content),callback:function ($$v) {_vm.$set(_vm.post, \"content\", $$v)},expression:\"post.content\"}},[(!_vm.isLatest && _vm.latest.post && _vm.current.post)?_c('el-alert',{staticClass:\"m-latest-check\",attrs:{\"type\":\"warning\",\"show-icon\":\"\"},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('span',{staticClass:\"u-alert-title\"},[_vm._v(\"当前百科已经有更新的版本，你的攻略可能已经失效，请先进行比对。\")]),_c('el-link',{staticClass:\"u-view-latest\",attrs:{\"type\":\"primary\",\"icon\":\"el-icon-link\",\"href\":_vm.getLink(_vm.post.source_id),\"target\":\"_blank\"}},[_vm._v(\"查看最新攻略\")]),(_vm.latest.post)?_c('el-link',{staticClass:\"u-get-latest\",attrs:{\"icon\":\"el-icon-download\",\"type\":\"primary\"},on:{\"click\":_vm.getLatest}},[_vm._v(\"获取最新攻略\")]):_vm._e()]},proxy:true}],null,false,2238318328)}):_vm._e()],1)],1),_c('div',{staticClass:\"m-publish-commit\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}}),_c('el-button',{staticClass:\"u-publish\",attrs:{\"icon\":\"el-icon-s-promotion\",\"type\":\"primary\",\"disabled\":_vm.processing},on:{\"click\":_vm.toPublish}},[_vm._v(\"提交攻略\")])],1)])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./item.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./item.vue?vue&type=script&lang=js\"","<template>\n    <div class=\"m-publish-box\">\n        <!-- 头部 -->\n        <publish-header name=\"物品百科\">\n            <slot name=\"header\"></slot>\n        </publish-header>\n\n        <el-form class=\"m-publish-post\">\n            <div class=\"m-publish-source\">\n                <el-divider content-position=\"left\">选择物品 *</el-divider>\n                <el-select\n                    class=\"u-source-id\"\n                    v-model=\"post.source_id\"\n                    filterable\n                    remote\n                    :disabled=\"!!post.id\"\n                    placeholder=\"输入物品名称/物品描述并按『回车』进行搜索\"\n                    :remote-method=\"search_handle\"\n                    :loading=\"options.loading\"\n                >\n                    <el-option v-for=\"item in options.sources\" :key=\"item.id\" :label=\"item.Name\" :value=\"item.id\">\n                        <div class=\"m-selector-item\">\n                            <img class=\"u-icon\" :src=\"icon_url_filter(item.IconID)\" :alt=\"item.Name\" />\n                            <span class=\"u-name\" v-text=\"item.Name\"></span>\n                        </div>\n                    </el-option>\n                </el-select>\n            </div>\n\n            <div class=\"m-publish-level\">\n                <el-divider content-position=\"left\">综合难度 *</el-divider>\n                <el-rate v-model=\"post.level\" class=\"u-level\"></el-rate>\n            </div>\n\n            <div class=\"m-publish-remark\">\n                <el-divider content-position=\"left\">修订说明 *</el-divider>\n                <el-input v-model=\"post.remark\" placeholder=\"请简单描述一下本次修订的说明\"></el-input>\n            </div>\n\n            <div class=\"m-publish-content\">\n                <el-divider content-position=\"left\">攻略正文 *</el-divider>\n                <Tinymce v-model=\"post.content\" :attachmentEnable=\"true\" :resourceEnable=\"true\" :height=\"400\">\n                    <el-alert type=\"warning\" class=\"m-latest-check\" show-icon v-if=\"!isLatest && latest.post && current.post\">\n                        <template #title>\n                            <span class=\"u-alert-title\">当前百科已经有更新的版本，你的攻略可能已经失效，请先进行比对。</span>\n                            <el-link type=\"primary\" icon=\"el-icon-link\" :href=\"getLink(post.source_id)\" target=\"_blank\" class=\"u-view-latest\">查看最新攻略</el-link>\n                            <el-link @click=\"getLatest\" icon=\"el-icon-download\" class=\"u-get-latest\" type=\"primary\" v-if=\"latest.post\">获取最新攻略</el-link>\n                        </template>\n                    </el-alert>\n                </Tinymce>\n            </div>\n\n            <div class=\"m-publish-commit\">\n                <el-divider content-position=\"left\"></el-divider>\n                <el-button class=\"u-publish\" icon=\"el-icon-s-promotion\" type=\"primary\" @click=\"toPublish\" :disabled=\"processing\">提交攻略</el-button>\n            </div>\n        </el-form>\n    </div>\n</template>\n\n<script>\nimport header from \"@/components/publish_header.vue\";\nimport Tinymce from \"@jx3box/jx3box-editor/src/Tinymce\";\n\n// 本地依赖\nimport { wiki } from \"@jx3box/jx3box-common/js/wiki_v2\";\n\nimport User from \"@jx3box/jx3box-common/js/user\";\nimport { search_items } from \"../service/item\";\nimport { iconLink, getLink } from \"@jx3box/jx3box-common/js/utils\";\n\nimport {uniqBy,pick} from 'lodash';\nexport default {\n    name: \"item\",\n    data() {\n        return {\n            //选项 - 加载可选项\n            options: {\n                sources: [],\n            },\n\n            //文章 - 主表数据\n            post: {\n                id: \"\", // 文章ID\n                content: \"\",\n                source_id: \"\",\n                level: 0,\n                remark: \"\",\n            },\n\n            // 状态控制\n            loading: false,\n            processing: false,\n\n            compatible: false, // 是否兼容模式\n\n            latest: {},\n            current: {}\n        };\n    },\n    computed : {\n        client : function (){\n            return this.$store.state.client\n        },\n        id : function (){\n            return this.$route.query?.post_id\n        },\n        // 当前比最新的攻略是否更新\n        isLatest : function (){\n            if(!this.current?.post?.id || !this.latest?.post?.id) return false\n            return this.current.post.id == this.latest.post.id\n        }\n    },\n    methods: {\n        toPublish: function() {\n            if (!this.post.source_id) {\n                this.$message({\n                    message: \"请选择要修订攻略的物品\",\n                    type: \"warning\",\n                });\n                return;\n            }\n\n            if (!this.post.content) {\n                this.$message({ message: \"要编写攻略正文哦\", type: \"warning\" });\n                return;\n            }\n\n            if (!(this.post.level >= 1 && this.post.level <= 5)) {\n                this.$message({\n                    message: \"请选择适合的综合难度\",\n                    type: \"warning\",\n                });\n                return;\n            }\n\n            if (!this.post.remark) {\n                this.$message({\n                    message: \"请简单描述本次修订说明\",\n                    type: \"warning\",\n                });\n                return;\n            }\n\n            this.processing = true;\n            const data = {\n                source_id: String(this.post.source_id),\n                level: this.post.level,\n                user_nickname: User.getInfo().name,\n                content: this.post.content,\n                remark: this.post.remark,\n            }\n            if (this.id) {\n                const _data = pick(data, [\"level\", \"content\", \"remark\"]);\n                wiki.update(this.id, { ..._data, client: this.client })\n                    .then((data) => {\n                        data = data.data;\n                        this.$message({\n                            message: \"提交成功，请等待审核\",\n                            type: \"success\",\n                        });\n                        setTimeout(() => {\n                            this.$router.push({ name: \"wiki_post\", params: { type: \"item\" } });\n                        }, 500);\n                    })\n                    .finally(() => {\n                        this.processing = false;\n                    });\n            } else{\n                wiki.post({ type: 'item', ...data, client: this.client })\n                    .then((data) => {\n                        data = data.data;\n                        this.$message({\n                            message: \"提交成功，请等待审核\",\n                            type: \"success\",\n                        });\n                        setTimeout(() => {\n                            this.$router.push({ name: \"wiki_post\", params: { type: \"item\" } });\n                        }, 500);\n                    })\n                    .finally(() => {\n                        this.processing = false;\n                    });\n            }\n        },\n        icon_url_filter(icon_id) {\n            return iconLink(icon_id);\n        },\n        // 物品搜索\n        search_handle(keyword = \"\") {\n            this.loading = true;\n            search_items(keyword, 10).then((res) => {\n                res = res.data;\n                this.options.sources = res.data.data;\n                this.loading = false;\n            });\n        },\n        loadData: function(client) {\n            if (!this.post.source_id) return;\n            this.loading = true;\n            return wiki.get({ type: \"item\", id: this.post.source_id }, { client })\n                .then((res) => {\n                    let data = res.data;\n                    // 数据填充\n                    let post = data.data.post;\n                    let item = data.data.source;\n\n                    if (post) {\n                        this.post.source_id = post.source_id;\n                        this.post.level = post.level || 1;\n                        this.post.remark = post.remark || \"\";\n                        this.post.content = post.content;\n                    } else {\n                        this.post.source_id = this.post.source_id ? this.post.source_id : \"\";\n                        this.post.level = 0;\n                        this.post.remark = \"\";\n                        this.post.content = \"\";\n                    }\n\n                    if (item) {\n                        // 将选择项恢复至下拉框\n                        if (this.compatible) {\n                            // 兼容模式下，客户端为正式服的物品，不放入下拉框\n                            if (client !== 'std') this.options.sources = uniqBy([this.options.sources, item], \"id\");\n                        } else {\n                            // 非兼容模式下的物品直接放入下拉框\n                            this.options.sources = uniqBy([this.options.sources, item], \"id\");\n                        }\n                    }\n\n                    return post;\n                })\n                .finally(() => {\n                    this.loading = false;\n                });\n        },\n        loadDataByPostId: function() {\n            this.loading = true;\n            return wiki.getById(this.id)\n                .then((res) => {\n                    this.current = res.data.data\n                    let data = res.data;\n                    // 数据填充\n                    let post = data.data.post;\n                    let item = data.data.source;\n\n                    if (post) {\n                        this.post.source_id = post.source_id;\n                        this.post.level = post.level || 1;\n                        this.post.remark = post.remark || \"\";\n                        this.post.content = post.content;\n                    } else {\n                        this.post.source_id = this.post.source_id ? this.post.source_id : \"\";\n                        this.post.level = 0;\n                        this.post.remark = \"\";\n                        this.post.content = \"\";\n                    }\n\n                    if (item) {\n                        // 将选择项恢复至下拉框\n                        if (this.compatible) {\n                            // 兼容模式下，客户端为正式服的物品，不放入下拉框\n                            if (client !== 'std') this.options.sources = uniqBy([this.options.sources, item], \"id\");\n                        } else {\n                            // 非兼容模式下的物品直接放入下拉框\n                            this.options.sources = uniqBy([this.options.sources, item], \"id\");\n                        }\n                    }\n\n                    return post;\n                })\n                .finally(() => {\n                    this.loading = false;\n                });\n        },\n        // 获取最新的攻略\n        loadLatest() {\n            if (!this.post.source_id) return;\n            wiki.get({ type: \"item\", id: this.post.source_id }).then(res => {\n                this.latest = res.data.data\n            })\n        },\n        getLink(id) {\n            return getLink(\"item\", id);\n        },\n        getLatest() {\n            this.post.content = this.latest.post?.content || ''\n        }\n    },\n    created() {\n        // 初始化搜索列表\n        this.search_handle(\"\");\n\n        // 获取物品ID并通过watch获取攻略\n        let id = this.$route.params.source_id;\n        this.post.source_id = id ? id : null;\n\n        // 获取最新的攻略\n        this.loadLatest()\n    },\n    watch: {\n        \"post.source_id\": {\n            handler: function() {\n                if (this.id) {\n                    this.loadDataByPostId();\n                    return;\n                }\n                if(this.client == 'std'){\n                    this.loadData('std')\n                }else{\n                    this.loadData('origin').then((post) => {\n                        this.compatible = true\n                        console.log('兼容获取')\n                        if(!post){\n                            this.loadData('std')\n                        }\n                    })\n                }\n            },\n        },\n    },\n    components: {\n        \"publish-header\": header,\n        Tinymce,\n    },\n};\n</script>\n\n<style scoped lang=\"less\">\n@import \"../assets/css/item.less\";\n@import \"../assets/css/wiki.less\";\n</style>\n","import { render, staticRenderFns } from \"./item.vue?vue&type=template&id=0657dffe&scoped=true\"\nimport script from \"./item.vue?vue&type=script&lang=js\"\nexport * from \"./item.vue?vue&type=script&lang=js\"\nimport style0 from \"./item.vue?vue&type=style&index=0&id=0657dffe&prod&scoped=true&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0657dffe\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=style&index=0&id=36319e52&prod&lang=less\"","import { $node } from \"@jx3box/jx3box-common/js/https.js\";\n\n// 物品搜索\nfunction search_items(keyword, length, fields, is_equip = null) {\n\tlet params = { keyword: keyword, limit: length, fields: fields };\n\tif (is_equip !== null) params.is_equip = is_equip ? 1 : 0;\n\n\treturn $node().get(`/item/search`, {\n        params\n    })\n}\n\n// 物品搜索\nfunction searchItems(params) {\n\treturn $node()\n\t\t.get(`/item/search`, { params })\n\t\t.then((res) => {\n\t\t\treturn res.data.data;\n\t\t});\n}\n\n// 获取物品\nfunction get_item(item_id) {\n\tif (!item_id) return;\n\treturn $node().get(`/item/id/${item_id}`);\n}\nexport { search_items, get_item, searchItems };\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./item.vue?vue&type=style&index=0&id=0657dffe&prod&scoped=true&lang=less\"","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=script&lang=js\"","<template>\n    <div class=\"m-publish-header\">\n        <el-page-header @back=\"goBack\" :content=\"name\"></el-page-header>\n        <slot></slot>\n    </div>\n</template>\n\n<script>\nexport default {\n    name: \"publish_header\",\n    props: [\"name\"],\n    data: function() {\n        return {\n        };\n    },\n    computed: {},\n    methods: {\n        goBack: function() {\n            if(window.history.length){\n                this.$router.go(-1);\n            }else{\n                this.$router.push('/')\n            }\n        },\n    },\n    mounted: function() {},\n    components: {\n    },\n};\n</script>\n\n<style lang=\"less\">\n    .m-publish-header{\n        .pr;\n    }\n    \n</style>","import { render, staticRenderFns } from \"./publish_header.vue?vue&type=template&id=36319e52\"\nimport script from \"./publish_header.vue?vue&type=script&lang=js\"\nexport * from \"./publish_header.vue?vue&type=script&lang=js\"\nimport style0 from \"./publish_header.vue?vue&type=style&index=0&id=36319e52&prod&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-publish-header\"},[_c('el-page-header',{attrs:{\"content\":_vm.name},on:{\"back\":_vm.goBack}}),_vm._t(\"default\")],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}
{"version":3,"sources":["webpack:///./src/service/quest.js","webpack:///./src/post/quest.vue?ce28","webpack:///src/post/quest.vue","webpack:///./src/post/quest.vue?222f","webpack:///./src/post/quest.vue","webpack:///./src/components/publish_header.vue?4823","webpack:///./src/post/quest.vue?408f","webpack:///./src/components/publish_header.vue?6f8c","webpack:///src/components/publish_header.vue","webpack:///./src/components/publish_header.vue?3a87","webpack:///./src/components/publish_header.vue"],"names":["get_list","params","$node","method","url","name","data","options","sources","post","id","content","source_id","level","remark","loading","processing","latest","current","computed","client","$store","state","_this$$route$query","$route","query","post_id","isLatest","_this$current","_this$current$post","_this$latest","_this$latest$post","methods","toPublish","_this","String","user_nickname","User","getInfo","_data","pick","wiki","update","_objectSpread","then","$message","message","type","setTimeout","$router","push","finally","search_handle","_this2","keyword","arguments","length","undefined","per","res","_res$data","_res$data$list","list","byKeyword","loadData","_this3","get","source","parseInt","replace","exist","index","QuestID","QuestName","loadDataByPostId","_this4","getById","loadLatest","_this5","getLink","getLatest","_this$latest$post2","created","watch","handler","val","_this6","console","log","components","header","Tinymce","component","_vm","this","_c","_self","staticClass","attrs","_t","_v","model","value","callback","$$v","$set","expression","_l","key","domProps","_s","scopedSlots","_u","fn","on","_e","proxy","props","goBack","window","history","go","mounted"],"mappings":"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","file":"js/chunk-17073475.18bad39f.js","sourcesContent":["import { $node } from \"@jx3box/jx3box-common/js/https.js\";\n\nfunction get_list(params) {\n    return $node()({\n        method: \"GET\",\n        url: `/quests`,\n        params: params,\n    });\n}\n\nexport { get_list };\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./quest.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./quest.vue?vue&type=script&lang=js\"","<template>\n    <div class=\"m-publish-box\">\n        <!-- 头部 -->\n        <publish-header name=\"任务百科\">\n            <slot name=\"header\"></slot>\n        </publish-header>\n\n        <el-form class=\"m-publish-post\">\n            <div class=\"m-publish-source\">\n                <el-divider content-position=\"left\">选择任务 *</el-divider>\n                <el-select\n                    class=\"u-source-id\"\n                    v-model=\"post.source_id\"\n                    filterable\n                    remote\n                    :disabled=\"!!post.id\"\n                    placeholder=\"输入任务名称（可适配中括号形式）「回车」进行搜索\"\n                    :remote-method=\"search_handle\"\n                    :loading=\"options.loading\"\n                >\n                    <el-option\n                        v-for=\"source in options.sources\"\n                        :key=\"source.id\"\n                        :label=\"source.name\"\n                        :value=\"source.id\"\n                    >\n                        <div class=\"m-selector-item\">\n                            <i class=\"el-icon-collection u-icon\"></i>\n                            <span class=\"u-name\" v-text=\"source.name\"></span>\n                        </div>\n                    </el-option>\n                </el-select>\n            </div>\n\n            <div class=\"m-publish-level\">\n                <el-divider content-position=\"left\">综合难度 *</el-divider>\n                <el-rate v-model=\"post.level\" class=\"u-level\"></el-rate>\n            </div>\n\n            <div class=\"m-publish-remark\">\n                <el-divider content-position=\"left\">修订说明 *</el-divider>\n                <el-input\n                    v-model=\"post.remark\"\n                    :maxlength=\"200\"\n                    :minlength=\"1\"\n                    show-word-limit\n                    required\n                    placeholder=\"请简单描述一下本次修订的说明\"\n                ></el-input>\n            </div>\n\n            <div class=\"m-publish-content\">\n                <el-divider content-position=\"left\">攻略正文 *</el-divider>\n                <Tinymce v-model=\"post.content\" :attachmentEnable=\"true\" :resourceEnable=\"true\" :height=\"400\">\n                    <el-alert type=\"warning\" class=\"m-latest-check\" show-icon v-if=\"!isLatest && latest.post && current.post\">\n                        <template #title>\n                            <span class=\"u-alert-title\">当前百科已经有更新的版本，你的攻略可能已经失效，请先进行比对。</span>\n                            <el-link type=\"primary\" icon=\"el-icon-link\" :href=\"getLink(post.source_id)\" target=\"_blank\" class=\"u-view-latest\">查看最新攻略</el-link>\n                            <el-link @click=\"getLatest\" icon=\"el-icon-download\" class=\"u-get-latest\" type=\"primary\" v-if=\"latest.post\">获取最新攻略</el-link>\n                        </template>\n                    </el-alert>\n                </Tinymce>\n            </div>\n\n            <div class=\"m-publish-commit\">\n                <el-divider content-position=\"left\"></el-divider>\n                <el-button\n                    class=\"u-publish\"\n                    icon=\"el-icon-s-promotion\"\n                    type=\"primary\"\n                    @click=\"toPublish\"\n                    :disabled=\"processing\"\n                    >提交攻略</el-button\n                >\n            </div>\n        </el-form>\n    </div>\n</template>\n\n<script>\nimport header from \"@/components/publish_header.vue\";\nimport Tinymce from \"@jx3box/jx3box-editor/src/Tinymce\";\n\n// 本地依赖\nimport { wiki } from \"@jx3box/jx3box-common/js/wiki_v2\";\nimport User from \"@jx3box/jx3box-common/js/user\";\nimport { get_list } from \"../service/quest\";\nimport { pick } from \"lodash\";\nimport { getLink } from \"@jx3box/jx3box-common/js/utils\";\n\nexport default {\n    name: \"quest\",\n    data() {\n        return {\n            //选项 - 加载可选项\n            options: {\n                sources: null,\n            },\n\n            //文章 - 主表数据\n            post: {\n                id: \"\", // 文章ID\n                content: \"\",\n                source_id: \"\",\n                level: 0,\n                remark: \"\",\n            },\n\n            // 状态控制\n            loading: false,\n            processing: false,\n\n            latest: {},\n            current: {}\n        };\n    },\n    computed: {\n        client() {\n            return this.$store.state.client;\n        },\n        id() {\n            return this.$route.query?.post_id;\n        },\n        // 当前比最新的攻略是否更新\n        isLatest : function (){\n            if(!this.current?.post?.id || !this.latest?.post?.id) return false\n            return this.current.post.id == this.latest.post.id\n        }\n    },\n    methods: {\n        toPublish: function () {\n            if (!this.post.source_id) {\n                this.$message({\n                    message: \"请选择要修订攻略的任务\",\n                    type: \"warning\",\n                });\n                return;\n            }\n\n            if (!this.post.content) {\n                this.$message({ message: \"要编写攻略正文哦\", type: \"warning\" });\n                return;\n            }\n\n            if (!(this.post.level >= 1 && this.post.level <= 5)) {\n                this.$message({\n                    message: \"请选择适合的综合难度\",\n                    type: \"warning\",\n                });\n                return;\n            }\n\n            if (!this.post.remark) {\n                this.$message({\n                    message: \"请简单描述本次修订说明\",\n                    type: \"warning\",\n                });\n                return;\n            }\n\n            this.processing = true;\n            const data = {\n                source_id: String(this.post.source_id),\n                level: this.post.level,\n                user_nickname: User.getInfo().name,\n                content: this.post.content,\n                remark: this.post.remark,\n            };\n\n            if (this.id) {\n                const _data = pick(data, [\"level\", \"content\", \"remark\"]);\n                wiki.update(this.id, { ..._data, client: this.client })\n                    .then((data) => {\n                        data = data.data;\n                        this.$message({\n                            message: \"提交成功，请等待审核\",\n                            type: \"success\",\n                        });\n                        setTimeout(() => {\n                            this.$router.push({ name: \"wiki_post\", params: { type: \"quest\" } });\n                        }, 500);\n                    })\n                    .finally(() => {\n                        this.processing = false;\n                    });\n            } else {\n                wiki.post({ type: \"quest\", ...data, client: this.client }, {})\n                    .then((data) => {\n                        data = data.data;\n                        this.$message({\n                            message: \"提交成功，请等待审核\",\n                            type: \"success\",\n                        });\n                        setTimeout(() => {\n                            this.$router.push({\n                                name: \"wiki_post\",\n                                params: { type: \"quest\" },\n                            });\n                        }, 500);\n                    })\n                    .finally(() => {\n                        this.processing = false;\n                    });\n            }\n        },\n        // 任务搜索\n        search_handle(keyword = \"\") {\n            this.loading = true;\n            get_list({\n                keyword: keyword,\n                per: 10,\n            }).then((res) => {\n                this.options.sources = res.data?.list?.byKeyword || [];\n                this.loading = false;\n            });\n        },\n        loadData: function (client) {\n            this.loading = true;\n            wiki.get({ type: 'quest', id: this.post.source_id }, { client: client })\n                .then((res) => {\n                    let data = res.data;\n                    // 数据填充\n                    let post = data.data.post;\n                    let source = data.data.source;\n\n                    if (post) {\n                        this.post.source_id = parseInt(post.source_id);\n                        this.post.level = post.level || 1;\n                        this.post.remark = post.remark;\n                        let content = post.content;\n                        content = content.replace(/(<p>)?\\s*◆任务难度 [★]+\\s*(<\\/p>)?/gi, \"\");\n                        content = content.replace(/(<p>)?\\s*◆花费时长 [★]+\\s*(<\\/p>)?/gi, \"\");\n                        content = content.replace(/(<p>)?\\s*◆任务攻略\\s*(<\\/p>)?/gi, \"\");\n                        this.post.content = content;\n                    } else {\n                        this.post.source_id = this.post.source_id ? parseInt(this.post.source_id) : \"\";\n                        this.post.level = 0;\n                        this.post.remark = \"\";\n                        this.post.content = \"\";\n                    }\n\n                    if (source) {\n                        // 将选择项恢复至下拉框\n                        let exist = false;\n                        this.options.sources = this.options.sources || [];\n                        for (let index in this.options.sources) {\n                            if (this.options.sources[index].id == source.QuestID) {\n                                exist = true;\n                                break;\n                            }\n                        }\n                        if (!exist) {\n                            source.id = source?.QuestID;\n                            source.name = source?.QuestName;\n                            this.options.sources.push(source);\n                        }\n                    }\n                })\n                .finally(() => {\n                    this.loading = false;\n                });\n        },\n        loadDataByPostId: function () {\n            this.loading = true;\n            wiki.getById(this.id)\n                .then((res) => {\n                    this.current = res.data.data\n                    let data = res.data;\n                    // 数据填充\n                    let post = data.data.post;\n                    let source = data.data.source;\n\n                    if (post) {\n                        this.post.source_id = parseInt(post.source_id);\n                        this.post.level = post.level || 1;\n                        this.post.remark = post.remark;\n                        let content = post.content;\n                        content = content.replace(/(<p>)?\\s*◆任务难度 [★]+\\s*(<\\/p>)?/gi, \"\");\n                        content = content.replace(/(<p>)?\\s*◆花费时长 [★]+\\s*(<\\/p>)?/gi, \"\");\n                        content = content.replace(/(<p>)?\\s*◆任务攻略\\s*(<\\/p>)?/gi, \"\");\n                        this.post.content = content;\n                    } else {\n                        this.post.source_id = this.post.source_id ? parseInt(this.post.source_id) : \"\";\n                        this.post.level = 0;\n                        this.post.remark = \"\";\n                        this.post.content = \"\";\n                    }\n\n                    if (source) {\n                        // 将选择项恢复至下拉框\n                        let exist = false;\n                        this.options.sources = this.options.sources || [];\n                        for (let index in this.options.sources) {\n                            if (this.options.sources[index].id == source.QuestID) {\n                                exist = true;\n                                break;\n                            }\n                        }\n                        if (!exist) {\n                            source.id = source?.QuestID;\n                            source.name = source?.QuestName;\n                            this.options.sources.push(source);\n                        }\n                    }\n                })\n                .finally(() => {\n                    this.loading = false;\n                });\n        },\n        // 获取最新的攻略\n        loadLatest() {\n            if (!this.post.source_id) return;\n            wiki.get({ type: \"quest\", id: this.post.source_id }).then(res => {\n                this.latest = res.data.data\n            })\n        },\n        getLink(id) {\n            return getLink(\"quest\", id);\n        },\n        getLatest() {\n            this.post.content = this.latest.post?.content || ''\n        }\n    },\n    created() {\n        // 初始化搜索列表\n        this.search_handle(\"\");\n\n        // 获取任务ID并通过watch获取攻略\n        let id = this.$route.params.source_id;\n        this.post.source_id = id ? parseInt(id) : null;\n\n        // 获取最新的攻略\n        this.loadLatest()\n    },\n    watch: {\n        \"post.source_id\": {\n            handler: function(val) {\n                if (!val) {\n                    return;\n                }\n                if (this.id) {\n                    this.loadDataByPostId();\n                    return;\n                }\n\n                if(this.client == 'std'){\n                    this.loadData('std')\n                }else{\n                    this.loadData('origin').then((post) => {\n                        console.log('兼容获取')\n                        if(!post){\n                            this.loadData('std')\n                        }\n                    })\n                }\n            },\n        },\n    },\n    components: {\n        \"publish-header\": header,\n        Tinymce,\n    },\n};\n</script>\n\n<style scoped lang=\"less\">\n@import \"../assets/css/quest.less\";\n@import \"../assets/css/wiki.less\";\n</style>\n","import { render, staticRenderFns } from \"./quest.vue?vue&type=template&id=22a8defe&scoped=true\"\nimport script from \"./quest.vue?vue&type=script&lang=js\"\nexport * from \"./quest.vue?vue&type=script&lang=js\"\nimport style0 from \"./quest.vue?vue&type=style&index=0&id=22a8defe&prod&scoped=true&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"22a8defe\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-publish-box\"},[_c('publish-header',{attrs:{\"name\":\"任务百科\"}},[_vm._t(\"header\")],2),_c('el-form',{staticClass:\"m-publish-post\"},[_c('div',{staticClass:\"m-publish-source\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"选择任务 *\")]),_c('el-select',{staticClass:\"u-source-id\",attrs:{\"filterable\":\"\",\"remote\":\"\",\"disabled\":!!_vm.post.id,\"placeholder\":\"输入任务名称（可适配中括号形式）「回车」进行搜索\",\"remote-method\":_vm.search_handle,\"loading\":_vm.options.loading},model:{value:(_vm.post.source_id),callback:function ($$v) {_vm.$set(_vm.post, \"source_id\", $$v)},expression:\"post.source_id\"}},_vm._l((_vm.options.sources),function(source){return _c('el-option',{key:source.id,attrs:{\"label\":source.name,\"value\":source.id}},[_c('div',{staticClass:\"m-selector-item\"},[_c('i',{staticClass:\"el-icon-collection u-icon\"}),_c('span',{staticClass:\"u-name\",domProps:{\"textContent\":_vm._s(source.name)}})])])}),1)],1),_c('div',{staticClass:\"m-publish-level\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"综合难度 *\")]),_c('el-rate',{staticClass:\"u-level\",model:{value:(_vm.post.level),callback:function ($$v) {_vm.$set(_vm.post, \"level\", $$v)},expression:\"post.level\"}})],1),_c('div',{staticClass:\"m-publish-remark\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"修订说明 *\")]),_c('el-input',{attrs:{\"maxlength\":200,\"minlength\":1,\"show-word-limit\":\"\",\"required\":\"\",\"placeholder\":\"请简单描述一下本次修订的说明\"},model:{value:(_vm.post.remark),callback:function ($$v) {_vm.$set(_vm.post, \"remark\", $$v)},expression:\"post.remark\"}})],1),_c('div',{staticClass:\"m-publish-content\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"攻略正文 *\")]),_c('Tinymce',{attrs:{\"attachmentEnable\":true,\"resourceEnable\":true,\"height\":400},model:{value:(_vm.post.content),callback:function ($$v) {_vm.$set(_vm.post, \"content\", $$v)},expression:\"post.content\"}},[(!_vm.isLatest && _vm.latest.post && _vm.current.post)?_c('el-alert',{staticClass:\"m-latest-check\",attrs:{\"type\":\"warning\",\"show-icon\":\"\"},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('span',{staticClass:\"u-alert-title\"},[_vm._v(\"当前百科已经有更新的版本，你的攻略可能已经失效，请先进行比对。\")]),_c('el-link',{staticClass:\"u-view-latest\",attrs:{\"type\":\"primary\",\"icon\":\"el-icon-link\",\"href\":_vm.getLink(_vm.post.source_id),\"target\":\"_blank\"}},[_vm._v(\"查看最新攻略\")]),(_vm.latest.post)?_c('el-link',{staticClass:\"u-get-latest\",attrs:{\"icon\":\"el-icon-download\",\"type\":\"primary\"},on:{\"click\":_vm.getLatest}},[_vm._v(\"获取最新攻略\")]):_vm._e()]},proxy:true}],null,false,2238318328)}):_vm._e()],1)],1),_c('div',{staticClass:\"m-publish-commit\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}}),_c('el-button',{staticClass:\"u-publish\",attrs:{\"icon\":\"el-icon-s-promotion\",\"type\":\"primary\",\"disabled\":_vm.processing},on:{\"click\":_vm.toPublish}},[_vm._v(\"提交攻略\")])],1)])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=style&index=0&id=36319e52&prod&lang=less\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./quest.vue?vue&type=style&index=0&id=22a8defe&prod&scoped=true&lang=less\"","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=script&lang=js\"","<template>\n    <div class=\"m-publish-header\">\n        <el-page-header @back=\"goBack\" :content=\"name\"></el-page-header>\n        <slot></slot>\n    </div>\n</template>\n\n<script>\nexport default {\n    name: \"publish_header\",\n    props: [\"name\"],\n    data: function() {\n        return {\n        };\n    },\n    computed: {},\n    methods: {\n        goBack: function() {\n            if(window.history.length){\n                this.$router.go(-1);\n            }else{\n                this.$router.push('/')\n            }\n        },\n    },\n    mounted: function() {},\n    components: {\n    },\n};\n</script>\n\n<style lang=\"less\">\n    .m-publish-header{\n        .pr;\n    }\n    \n</style>","import { render, staticRenderFns } from \"./publish_header.vue?vue&type=template&id=36319e52\"\nimport script from \"./publish_header.vue?vue&type=script&lang=js\"\nexport * from \"./publish_header.vue?vue&type=script&lang=js\"\nimport style0 from \"./publish_header.vue?vue&type=style&index=0&id=36319e52&prod&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-publish-header\"},[_c('el-page-header',{attrs:{\"content\":_vm.name},on:{\"back\":_vm.goBack}}),_vm._t(\"default\")],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}
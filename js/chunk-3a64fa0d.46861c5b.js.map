{"version":3,"sources":["webpack:///./src/post/achievement.vue?e71b","webpack:///./src/post/achievement.vue","webpack:///./src/service/achievement.js","webpack:///./src/post/achievement.vue?79ab","webpack:///src/post/achievement.vue","webpack:///./src/post/achievement.vue?da34","webpack:///./src/components/publish_header.vue?4823","webpack:///./src/components/publish_header.vue?6f8c","webpack:///src/components/publish_header.vue","webpack:///./src/components/publish_header.vue?3a87","webpack:///./src/components/publish_header.vue"],"names":["search_achievements","params","$node","get","name","data","options","sources","post","id","content","source_id","level","remark","loading","processing","latest","current","computed","client","$store","state","_this$$route$query","$route","query","post_id","isLatest","_this$current","_this$current$post","_this$latest","_this$latest$post","methods","toPublish","_this","String","user_nickname","User","getInfo","_data","pick","wiki","update","_objectSpread","then","$message","message","type","setTimeout","$router","push","finally","icon_url_filter","icon_id","iconLink","search_handle","_this2","keyword","arguments","length","undefined","limit","res","code","achievements","loadData","_this3","achievement","source","parseInt","replace","exist","index","ID","loadDataByPostId","_this4","getById","loadLatest","_this5","getLink","getLatest","_this$latest$post2","created","achievement_id","watch","handler","val","_this6","console","log","components","header","Tinymce","component","_vm","this","_c","_self","staticClass","attrs","_t","_v","model","value","callback","$$v","$set","expression","_l","item","key","Name","IconID","domProps","_s","scopedSlots","_u","fn","on","_e","proxy","props","goBack","window","history","go","mounted"],"mappings":"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","file":"js/chunk-3a64fa0d.46861c5b.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./achievement.vue?vue&type=style&index=0&id=2ffd0b58&prod&scoped=true&lang=less\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-publish-box\"},[_c('publish-header',{attrs:{\"name\":\"成就百科\"}},[_vm._t(\"header\")],2),_c('el-form',{staticClass:\"m-publish-post\"},[_c('div',{staticClass:\"m-publish-source\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"选择成就 *\")]),_c('el-select',{staticClass:\"u-source-id\",attrs:{\"filterable\":\"\",\"remote\":\"\",\"disabled\":!!_vm.post.id,\"placeholder\":\"输入成就名称/成就描述/称号/奖励物品并按『回车』进行搜索\",\"remote-method\":_vm.search_handle,\"loading\":_vm.options.loading},model:{value:(_vm.post.source_id),callback:function ($$v) {_vm.$set(_vm.post, \"source_id\", $$v)},expression:\"post.source_id\"}},_vm._l((_vm.options.sources),function(item){return _c('el-option',{key:item.ID,attrs:{\"label\":item.Name,\"value\":item.ID}},[_c('div',{staticClass:\"m-selector-item\"},[_c('img',{staticClass:\"u-icon\",attrs:{\"src\":_vm.icon_url_filter(item.IconID),\"alt\":item.Name}}),_c('span',{staticClass:\"u-name\",domProps:{\"textContent\":_vm._s(item.Name)}})])])}),1)],1),_c('div',{staticClass:\"m-publish-level\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"综合难度 *\")]),_c('el-rate',{staticClass:\"u-level\",model:{value:(_vm.post.level),callback:function ($$v) {_vm.$set(_vm.post, \"level\", $$v)},expression:\"post.level\"}})],1),_c('div',{staticClass:\"m-publish-remark\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"修订说明 *\")]),_c('el-input',{attrs:{\"maxlength\":200,\"minlength\":1,\"show-word-limit\":\"\",\"required\":\"\",\"placeholder\":\"请简单描述一下本次修订的说明\"},model:{value:(_vm.post.remark),callback:function ($$v) {_vm.$set(_vm.post, \"remark\", $$v)},expression:\"post.remark\"}})],1),_c('div',{staticClass:\"m-publish-content\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"攻略正文 *\")]),_c('Tinymce',{attrs:{\"attachmentEnable\":true,\"resourceEnable\":true,\"height\":400},model:{value:(_vm.post.content),callback:function ($$v) {_vm.$set(_vm.post, \"content\", $$v)},expression:\"post.content\"}},[(!_vm.isLatest && _vm.latest.post && _vm.current.post)?_c('el-alert',{staticClass:\"m-latest-check\",attrs:{\"type\":\"warning\",\"show-icon\":\"\"},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('span',{staticClass:\"u-alert-title\"},[_vm._v(\"当前百科已经有更新的版本，你的攻略可能已经失效，请先进行比对。\")]),_c('el-link',{staticClass:\"u-view-latest\",attrs:{\"type\":\"primary\",\"icon\":\"el-icon-link\",\"href\":_vm.getLink(_vm.post.source_id),\"target\":\"_blank\"}},[_vm._v(\"查看最新攻略\")]),(_vm.latest.post)?_c('el-link',{staticClass:\"u-get-latest\",attrs:{\"icon\":\"el-icon-download\",\"type\":\"primary\"},on:{\"click\":_vm.getLatest}},[_vm._v(\"获取最新攻略\")]):_vm._e()]},proxy:true}],null,false,2238318328)}):_vm._e()],1)],1),_c('div',{staticClass:\"m-publish-commit\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}}),_c('el-button',{staticClass:\"u-publish\",attrs:{\"icon\":\"el-icon-s-promotion\",\"type\":\"primary\",\"disabled\":_vm.processing},on:{\"click\":_vm.toPublish}},[_vm._v(\"提交攻略 \")])],1)])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { $node } from \"@jx3box/jx3box-common/js/https.js\";\n\n// 成就搜索\nfunction search_achievements(params) {\n    return $node().get(`/achievement/search`, {\n        params\n    })\n}\n\nexport { search_achievements };\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./achievement.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./achievement.vue?vue&type=script&lang=js\"","<template>\n    <div class=\"m-publish-box\">\n        <!-- 头部 -->\n        <publish-header name=\"成就百科\">\n            <slot name=\"header\"></slot>\n        </publish-header>\n\n        <el-form class=\"m-publish-post\">\n            <div class=\"m-publish-source\">\n                <el-divider content-position=\"left\">选择成就 *</el-divider>\n                <el-select\n                    class=\"u-source-id\"\n                    v-model=\"post.source_id\"\n                    filterable\n                    remote\n                    :disabled=\"!!post.id\"\n                    placeholder=\"输入成就名称/成就描述/称号/奖励物品并按『回车』进行搜索\"\n                    :remote-method=\"search_handle\"\n                    :loading=\"options.loading\"\n                >\n                    <el-option v-for=\"item in options.sources\" :key=\"item.ID\" :label=\"item.Name\" :value=\"item.ID\">\n                        <div class=\"m-selector-item\">\n                            <img class=\"u-icon\" :src=\"icon_url_filter(item.IconID)\" :alt=\"item.Name\" />\n                            <span class=\"u-name\" v-text=\"item.Name\"></span>\n                        </div>\n                    </el-option>\n                </el-select>\n            </div>\n\n            <div class=\"m-publish-level\">\n                <el-divider content-position=\"left\">综合难度 *</el-divider>\n                <el-rate v-model=\"post.level\" class=\"u-level\"></el-rate>\n            </div>\n\n            <div class=\"m-publish-remark\">\n                <el-divider content-position=\"left\">修订说明 *</el-divider>\n                <el-input\n                    v-model=\"post.remark\"\n                    :maxlength=\"200\"\n                    :minlength=\"1\"\n                    show-word-limit\n                    required\n                    placeholder=\"请简单描述一下本次修订的说明\"\n                ></el-input>\n            </div>\n\n            <div class=\"m-publish-content\">\n                <el-divider content-position=\"left\">攻略正文 *</el-divider>\n                <Tinymce v-model=\"post.content\" :attachmentEnable=\"true\" :resourceEnable=\"true\" :height=\"400\">\n                    <el-alert type=\"warning\" class=\"m-latest-check\" show-icon v-if=\"!isLatest && latest.post && current.post\">\n                        <template #title>\n                            <span class=\"u-alert-title\">当前百科已经有更新的版本，你的攻略可能已经失效，请先进行比对。</span>\n                            <el-link type=\"primary\" icon=\"el-icon-link\" :href=\"getLink(post.source_id)\" target=\"_blank\" class=\"u-view-latest\">查看最新攻略</el-link>\n                            <el-link @click=\"getLatest\" icon=\"el-icon-download\" class=\"u-get-latest\" type=\"primary\" v-if=\"latest.post\">获取最新攻略</el-link>\n                        </template>\n                    </el-alert>\n                </Tinymce>\n            </div>\n\n            <div class=\"m-publish-commit\">\n                <el-divider content-position=\"left\"></el-divider>\n                <el-button\n                    class=\"u-publish\"\n                    icon=\"el-icon-s-promotion\"\n                    type=\"primary\"\n                    @click=\"toPublish\"\n                    :disabled=\"processing\"\n                    >提交攻略\n                </el-button>\n            </div>\n        </el-form>\n    </div>\n</template>\n\n<script>\nimport header from \"@/components/publish_header.vue\";\nimport Tinymce from \"@jx3box/jx3box-editor/src/Tinymce\";\n\n// 本地依赖\nimport { wiki } from \"@jx3box/jx3box-common/js/wiki_v2\";\nimport User from \"@jx3box/jx3box-common/js/user\";\nimport { search_achievements } from \"../service/achievement\";\nimport { iconLink, getLink } from \"@jx3box/jx3box-common/js/utils\";\nimport { pick } from \"lodash\";\nexport default {\n    name: \"achievement\",\n    data() {\n        return {\n            //选项 - 加载可选项\n            options: {\n                sources: null,\n            },\n\n            //文章 - 主表数据\n            post: {\n                id: \"\", // 文章ID\n                content: \"\",\n                source_id: \"\",\n                level: 0,\n                remark: \"\",\n            },\n\n            // 状态控制\n            loading: false,\n            processing: false,\n\n            latest: {},\n            current: {}\n        };\n    },\n    computed: {\n        client: function () {\n            return this.$store.state.client;\n        },\n        id: function () {\n            return this.$route.query?.post_id;\n        },\n        // 当前比最新的攻略是否更新\n        isLatest : function (){\n            if(!this.current?.post?.id || !this.latest?.post?.id) return false\n            return this.current.post.id == this.latest.post.id\n        }\n    },\n    methods: {\n        toPublish: function () {\n            if (!this.post.source_id) {\n                this.$message({\n                    message: \"请选择要修订攻略的成就\",\n                    type: \"warning\",\n                });\n                return;\n            }\n\n            if (!this.post.content) {\n                this.$message({ message: \"要编写攻略正文哦\", type: \"warning\" });\n                return;\n            }\n\n            if (!(this.post.level >= 1 && this.post.level <= 5)) {\n                this.$message({\n                    message: \"请选择适合的综合难度\",\n                    type: \"warning\",\n                });\n                return;\n            }\n\n            if (!this.post.remark) {\n                this.$message({\n                    message: \"请简单描述本次修订说明\",\n                    type: \"warning\",\n                });\n                return;\n            }\n\n            this.processing = true;\n            const data = {\n                source_id: String(this.post.source_id),\n                level: this.post.level,\n                user_nickname: User.getInfo().name,\n                content: this.post.content,\n                remark: this.post.remark,\n            };\n\n            if (this.id) {\n                const _data = pick(data, [\"level\", \"content\", \"remark\"]);\n                wiki.update(this.id, { ..._data, client: this.client })\n                    .then((data) => {\n                        data = data.data;\n                        this.$message({\n                            message: \"提交成功，请等待审核\",\n                            type: \"success\",\n                        });\n                        setTimeout(() => {\n                            this.$router.push({ name: \"wiki_post\", params: { type: \"achievement\" } });\n                        }, 500);\n                    })\n                    .finally(() => {\n                        this.processing = false;\n                    });\n            } else {\n                wiki.post({ type: \"achievement\", ...data, client: this.client })\n                    .then((data) => {\n                        data = data.data;\n                        this.$message({\n                            message: \"提交成功，请等待审核\",\n                            type: \"success\",\n                        });\n                        setTimeout(() => {\n                            this.$router.push({ name: \"wiki_post\", params: { type: \"achievement\" } });\n                        }, 500);\n                    })\n                    .finally(() => {\n                        this.processing = false;\n                    });\n            }\n        },\n        icon_url_filter(icon_id) {\n            return iconLink(icon_id);\n        },\n        // 成就搜索\n        search_handle(keyword = \"\") {\n            this.loading = true;\n            search_achievements({\n                keyword: keyword,\n                limit: 10,\n            }).then((res) => {\n                res = res.data;\n                if (res.code === 200) this.options.sources = res.data.achievements;\n                this.loading = false;\n            });\n        },\n        loadData: function (client) {\n            if (!this.post.source_id) return;\n            this.loading = true;\n            return wiki\n                .get({ type: \"achievement\", id: this.post.source_id,}, { client: client })\n                .then((res) => {\n                    let data = res.data;\n                    // 数据填充\n                    let post = data.data.post;\n                    let achievement = data.data.source;\n\n                    if (post) {\n                        this.post.source_id = parseInt(post.source_id);\n                        this.post.level = post.level || 1;\n                        this.post.remark = post.remark || \"\";\n                        let content = post.content;\n                        content = content.replace(/(<p>)?\\s*◆成就难度 [★]+\\s*(<\\/p>)?/gi, \"\");\n                        content = content.replace(/(<p>)?\\s*◆花费时长 [★]+\\s*(<\\/p>)?/gi, \"\");\n                        content = content.replace(/(<p>)?\\s*◆成就攻略\\s*(<\\/p>)?/gi, \"\");\n                        this.post.content = content;\n                    } else {\n                        this.post.source_id = this.post.source_id ? parseInt(this.post.source_id) : \"\";\n                        this.post.level = 0;\n                        this.post.remark = \"\";\n                        this.post.content = \"\";\n                    }\n\n                    if (achievement) {\n                        // 将选择项恢复至下拉框\n                        let exist = false;\n                        this.options.sources = this.options.sources || [];\n                        for (let index in this.options.sources) {\n                            if (this.options.sources[index].ID == achievement.ID) {\n                                exist = true;\n                                break;\n                            }\n                        }\n                        if (!exist) this.options.sources.push(achievement);\n                    }\n\n                    return post;\n                })\n                .finally(() => {\n                    this.loading = false;\n                });\n        },\n        loadDataByPostId: function () {\n            this.loading = true;\n            return wiki\n            .getById(this.id)\n            .then((res) => {\n                    this.current = res.data.data\n                    let data = res.data;\n                    // 数据填充\n                    let post = data.data.post;\n                    let achievement = data.data.source;\n\n                    if (post) {\n                        this.post.source_id = parseInt(post.source_id);\n                        this.post.level = post.level || 1;\n                        this.post.remark = post.remark || \"\";\n                        let content = post.content;\n                        content = content.replace(/(<p>)?\\s*◆成就难度 [★]+\\s*(<\\/p>)?/gi, \"\");\n                        content = content.replace(/(<p>)?\\s*◆花费时长 [★]+\\s*(<\\/p>)?/gi, \"\");\n                        content = content.replace(/(<p>)?\\s*◆成就攻略\\s*(<\\/p>)?/gi, \"\");\n                        this.post.content = content;\n                    } else {\n                        this.post.source_id = this.post.source_id ? parseInt(this.post.source_id) : \"\";\n                        this.post.level = 0;\n                        this.post.remark = \"\";\n                        this.post.content = \"\";\n                    }\n\n                    if (achievement) {\n                        // 将选择项恢复至下拉框\n                        let exist = false;\n                        this.options.sources = this.options.sources || [];\n                        for (let index in this.options.sources) {\n                            if (this.options.sources[index].ID == achievement.ID) {\n                                exist = true;\n                                break;\n                            }\n                        }\n                        if (!exist) this.options.sources.push(achievement);\n                    }\n\n                    return post;\n                })\n                .finally(() => {\n                    this.loading = false;\n                });\n        },\n        // 获取最新的攻略\n        loadLatest() {\n            if (!this.post.source_id) return;\n            wiki.get({ type: \"achievement\", id: this.post.source_id }).then(res => {\n                this.latest = res.data.data\n            })\n        },\n        getLink(id) {\n            return getLink(\"achievement\", id);\n        },\n        getLatest() {\n            this.post.content = this.latest.post?.content || ''\n        }\n    },\n    created() {\n        // 初始化搜索列表\n        this.search_handle(\"\");\n\n        // 获取成就ID并通过watch获取攻略\n        let id = this.$route.params.achievement_id;\n        this.post.source_id = id ? parseInt(id) : null;\n\n        // 获取最新的攻略\n        this.loadLatest()\n    },\n    watch: {\n        \"post.source_id\": {\n            handler: function(val) {\n                if (this.id) {\n                    this.loadDataByPostId();\n                    return;\n                }\n\n                if(this.client == 'std'){\n                    this.loadData('std')\n                }else{\n                    this.loadData('origin').then((post) => {\n                        console.log('兼容获取')\n                        if(!post){\n                            this.loadData('std')\n                        }\n                    })\n                }\n            },\n        },\n    },\n    components: {\n        \"publish-header\": header,\n        Tinymce,\n    },\n};\n</script>\n\n<style scoped lang=\"less\">\n@import \"../assets/css/achievement.less\";\n@import \"../assets/css/wiki.less\";\n</style>\n","import { render, staticRenderFns } from \"./achievement.vue?vue&type=template&id=2ffd0b58&scoped=true\"\nimport script from \"./achievement.vue?vue&type=script&lang=js\"\nexport * from \"./achievement.vue?vue&type=script&lang=js\"\nimport style0 from \"./achievement.vue?vue&type=style&index=0&id=2ffd0b58&prod&scoped=true&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2ffd0b58\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=style&index=0&id=36319e52&prod&lang=less\"","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=script&lang=js\"","<template>\n    <div class=\"m-publish-header\">\n        <el-page-header @back=\"goBack\" :content=\"name\"></el-page-header>\n        <slot></slot>\n    </div>\n</template>\n\n<script>\nexport default {\n    name: \"publish_header\",\n    props: [\"name\"],\n    data: function() {\n        return {\n        };\n    },\n    computed: {},\n    methods: {\n        goBack: function() {\n            if(window.history.length){\n                this.$router.go(-1);\n            }else{\n                this.$router.push('/')\n            }\n        },\n    },\n    mounted: function() {},\n    components: {\n    },\n};\n</script>\n\n<style lang=\"less\">\n    .m-publish-header{\n        .pr;\n    }\n    \n</style>","import { render, staticRenderFns } from \"./publish_header.vue?vue&type=template&id=36319e52\"\nimport script from \"./publish_header.vue?vue&type=script&lang=js\"\nexport * from \"./publish_header.vue?vue&type=script&lang=js\"\nimport style0 from \"./publish_header.vue?vue&type=style&index=0&id=36319e52&prod&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-publish-header\"},[_c('el-page-header',{attrs:{\"content\":_vm.name},on:{\"back\":_vm.goBack}}),_vm._t(\"default\")],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}
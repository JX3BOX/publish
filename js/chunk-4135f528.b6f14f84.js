(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4135f528"],{"09b5":function(t,e,a){"use strict";a("f917")},"208a":function(t,e,a){"use strict";a.d(e,"c",(function(){return n})),a.d(e,"b",(function(){return r})),a.d(e,"a",(function(){return l})),a.d(e,"e",(function(){return c})),a.d(e,"d",(function(){return s}));var i=a("41cb");a("4328");function n(t){return Object(i.a)().get("/api/cms/app/item_plans/mine",{params:t}).then((function(t){return t.data.data}))}function s(t){return Object(i.a)().get("/api/cms/app/item_plan/".concat(t)).then((function(t){return t.data.data}))}function l(t){return Object(i.a)().post("/api/cms/app/item_plan",t)}function c(t,e){return Object(i.a)().put("/api/cms/app/item_plan/".concat(t),e)}function r(t){return Object(i.a)().delete("/api/cms/app/item_plan/".concat(t))}},5241:function(t,e,a){},"61d5":function(t,e,a){},"9f91":function(t,e,a){},b78a:function(t,e,a){"use strict";a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return l})),a.d(e,"b",(function(){return s}));var i=a("41cb");function n(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s={keyword:t,limit:e,fields:a};return null!==n&&(s.is_equip=n?1:0),Object(i.b)()({method:"GET",url:"/api/item/search",params:s})}function s(t){return Object(i.b)().get("/api/item/search",{params:t}).then((function(t){return t.data.data}))}function l(t){if(t)return Object(i.b)().get("api/item/".concat(t))}},bec3:function(t,e,a){"use strict";a("61d5")},df1f:function(t,e,a){"use strict";a("9f91")},e9fe:function(t,e,a){"use strict";a.r(e);var i=a("53ca"),n=(a("99af"),a("d81d"),a("d3b7"),a("159b"),a("ef77")),s=a("7a5f"),l=(a("b64b"),a("c7fa")),c=a("b78a"),r=a("65c2"),u=a("85e4"),o={name:"ItemIcon",props:["item","item_id","dishoverable","click_trigger"],data:function(){return{source:null}},computed:{client:function(){return this.$store.state.client}},components:{"jx3-item":l.a},methods:{get_data:function(t){var e=this;t&&Object(c.a)(t).then((function(t){var a=t.data.data.item;Object.keys(a).length&&(e.source=a)}))},show:function(){this.source&&void 0!==this.source.Genre||this.get_data(this.source.id)},item_border:function(t){switch(t.Quality){case 3:return"url(".concat(r.__imgPath,"image/item/blue.png)");case 4:return"url(".concat(r.__imgPath,"image/item/purple.png)");case 5:return"url(".concat(r.__imgPath,"image/item/orange.gif)");default:return""}},item_border_quest:function(t){return t.IsQuest>0?"url(".concat(r.__imgPath,"image/item/renwu.png)"):""},icon_url:function(t){return Object(u.iconLink)(t)}},watch:{item:{immediate:!0,handler:function(){this.source=this.item}},item_id:{immediate:!0,handler:function(){this.get_data(this.item_id)}}}},d=(a("df1f"),a("09b5"),a("2877")),p=Object(d.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.source?a("el-popover",{attrs:{placement:"right-start",width:"auto",trigger:t.click_trigger?"click":"hover",disabled:t.dishoverable,"popper-class":"m-item-icon-popup","visible-arrow":!1,transition:"none","close-delay":0},on:{show:t.show}},[a("template",{slot:"reference"},[a("div",{staticClass:"m-item-icon"},[a("div",{staticClass:"u-item-icon"},[a("div",{staticClass:"u-border",style:{backgroundImage:t.item_border(t.source),opacity:5==t.source.Quality?.9:1}}),a("div",{staticClass:"u-border-quest",style:{backgroundImage:t.item_border_quest(t.source)}}),a("img",{staticClass:"u-item-icon",attrs:{src:t.icon_url(t.source.IconID)}})]),a("div",{staticClass:"u-name",class:"quality-"+t.source.Quality},[t._v(t._s(t.source.Name))])])]),a("jx3-item",{attrs:{item:t.source}})],2):t._e()}),[],!1,null,"409202d7",null).exports,m=a("b76a"),f=a.n(m),b=a("208a"),h={id:"",title:"",public:1,type:"1",description:"",relation:[]},g=[[{title:"melee_weapon",label:"武器",AucGenre:1,list:[]},{title:"range_weapon",label:"暗器",AucGenre:2,list:[]}],[{title:"helm",label:"帽子",AucGenre:3,AucSubType:2,list:[]},{title:"chest",label:"上衣",AucGenre:3,AucSubType:1,list:[]},{title:"waist",label:"腰带",AucGenre:3,AucSubType:3,list:[]}],[{title:"bangle",label:"护腕",AucGenre:3,AucSubType:6,list:[]},{title:"pants",label:"下装",AucGenre:3,AucSubType:4,list:[]},{title:"boots",label:"鞋子",AucGenre:3,AucSubType:5,list:[]}],[{title:"amulet",label:"项链",AucGenre:4,AucSubType:1,list:[]},{title:"pendant",label:"腰坠",AucGenre:4,AucSubType:3,list:[]},{title:"ring_1",label:"戒指",AucGenre:4,AucSubType:2,list:[]},{title:"ring_2",label:"戒指",AucGenre:4,AucSubType:2,list:[]}]],_={name:"plan",components:{draggable:f.a,"publish-header":n.a,"jx3-item-simple":s.a,itemIcon:p},data:function(){return{data:Object.assign({},h),relationList:[],equipList:[].concat(g),loading:!1,keyword:"",per:15,page:1,total:1,searchList:[],item_id:""}},computed:{plan_id:function(){return this.$route.params.plan_id},search_params:function(){var t={page:this.page,limit:this.per,is_equip:2==this.data.type?1:0,fields:["id","UiID","Name","IconID","Quality","AucGenre","AucSubType","DescHtml"],apply:1};return this.keyword&&(t.keyword=this.keyword),t}},watch:{keyword:function(){this.resetPages()},search_params:{immediate:!0,deep:!0,handler:function(){this.loadItems()}}},methods:{loadItems:function(){var t=this;Object(c.b)(this.search_params).then((function(e){e.data.map((function(t){return t.count=1})),t.searchList=e.data,t.total=e.total}))},resetPages:function(){this.page=1},iconLink:u.iconLink,addRelation:function(){this.data.relation.unshift({title:"",data:[]})},moveHandle:function(t){if(!t.to.classList.contains("u-item-drag")){var e=t.to.getAttribute("data-AucGenre"),a=t.to.getAttribute("data-AucSubType"),i=t.draggedContext.element.AucGenre==e;return null!==a&&(i=i&&t.draggedContext.element.AucSubType==a),i}},getPlanData:function(){var t=this;Object(b.d)(this.plan_id).then((function(e){e=t.extractID(e),console.log(e),t.data=e,2==t.data.type&&t.toEquipList(t.data.relation)}))},extractID:function(t){return 1==t.type?t.relation=t.relation.map((function(t){return t.data=t.data.map((function(t){return"string"==typeof t&&(t={id:t,count:1}),"object"==Object(i.a)(t)&&(t={id:t.id,count:t.count}),t})),t})):t.relation=this.equipItem(t.relation),t},equipItem:function(t){for(var e in t)t[e]=t[e].map((function(t){return"object"==Object(i.a)(t)&&(t=t.id),t}));return t},toEquipList:function(t){this.equipList.map((function(e){e.map((function(e){t.hasOwnProperty(e.title)&&(e.list=t[e.title])}))}))},toEquip:function(){var t={};this.equipList.forEach((function(e){e.forEach((function(e){t[e.title]=e.list}))})),t=this.equipItem(t),this.data.relation=t},submit:function(){var t=this;2==this.data.type&&this.toEquip(),this.loading=!0,this.plan_id?Object(b.e)(this.plan_id,this.data).then((function(){t.$message({message:"物品清单修改成功",type:"success"}),t.$router.push({name:"bucket",params:{type:"item_plan"}})})).finally((function(){t.loading=!1})):Object(b.a)(this.data).then((function(){t.$message({message:"物品清单提交成功",type:"success"}),t.$router.push({name:"bucket",params:{type:"item_plan"}})})).finally((function(){t.loading=!1}))}},created:function(){this.plan_id&&this.getPlanData()}},v=(a("ff79"),Object(d.a)(_,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"m-publish-box"},[a("publish-header",{attrs:{name:"物品清单",localDraft:!1}},[t._t("header")],2),a("el-form",{staticClass:"u-form",attrs:{"label-position":"left","label-width":"80px"}},[a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{attrs:{placeholder:"请输入物品清单的标题",maxlength:"20","show-word-limit":""},model:{value:t.data.title,callback:function(e){t.$set(t.data,"title",e)},expression:"data.title"}})],1),a("el-form-item",{attrs:{label:"可见性"}},[a("el-radio",{attrs:{label:1},model:{value:t.data.public,callback:function(e){t.$set(t.data,"public",e)},expression:"data.public"}},[t._v("公开")]),a("el-radio",{attrs:{label:0},model:{value:t.data.public,callback:function(e){t.$set(t.data,"public",e)},expression:"data.public"}},[t._v("私有")])],1),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"简单说明一下你的物品清单",maxlength:2e3,"show-word-limit":""},model:{value:t.data.description,callback:function(e){t.$set(t.data,"description",e)},expression:"data.description"}})],1),a("el-form-item",{attrs:{label:"类型"}},[a("el-radio-group",{attrs:{size:"medium"},on:{change:t.resetPages},model:{value:t.data.type,callback:function(e){t.$set(t.data,"type",e)},expression:"data.type"}},[a("el-radio-button",{attrs:{label:"1"}},[t._v("道具清单")]),a("el-radio-button",{attrs:{label:"2"}},[t._v("装备清单")])],1),a("el-button",{staticClass:"u-add-plan",attrs:{size:"medium",icon:"el-icon-plus"},on:{click:t.addRelation}},[t._v("新增清单")])],1),a("el-form-item",{attrs:{label:"清单"}},[a("div",{staticClass:"m-plan-list"},[t.searchList.length?a("div",{staticClass:"u-list-search"},[a("el-input",{staticClass:"u-title",attrs:{placeholder:"请输入物品名称（可适配中括号）","prefix-icon":"el-icon-search"},model:{value:t.keyword,callback:function(e){t.keyword="string"==typeof e?e.trim():e},expression:"keyword"}}),a("draggable",{attrs:{draggable:".u-change",move:t.moveHandle,group:{name:"draggable-item",pull:"clone",put:!1}},model:{value:t.searchList,callback:function(e){t.searchList=e},expression:"searchList"}},t._l(t.searchList,(function(t,e){return a("jx3-item-simple",{key:e,staticClass:"u-change",attrs:{item:t}})})),1),a("el-pagination",{staticClass:"m-archive-pages",attrs:{small:"",background:"",layout:"prev, pager, next, jumper","hide-on-single-page":!0,"page-size":t.per,total:t.total,"current-page":t.page,size:"mini"},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e}}})],1):t._e(),"1"==t.data.type?a("el-row",{staticClass:"u-list-box",attrs:{gutter:20}},t._l(t.data.relation,(function(e,i){return a("el-col",{key:i,attrs:{span:6}},[a("div",{staticClass:"u-list"},[a("i",{staticClass:"u-list-close el-icon-circle-close",on:{click:function(e){return t.data.relation.splice(i,1)}}}),a("el-input",{staticClass:"u-title",attrs:{type:"text",placeholder:"子清单标题（选填）",maxlength:"20","show-word-limit":""},model:{value:e.title,callback:function(a){t.$set(e,"title",a)},expression:"relation.title"}}),a("draggable",{staticClass:"u-item-drag",attrs:{list:e.data,group:"draggable-item","ghost-class":"ghost"}},[e.data&&e.data.length?t._l(e.data,(function(i,n){return a("div",{key:n,staticClass:"u-selected u-selected-item u-selected-count"},[a("itemIcon",{staticClass:"u-icon",attrs:{item_id:i.id}}),a("div",{staticClass:"u-count"},[a("span",[t._v("数量：")]),a("el-input-number",{attrs:{size:"mini",min:1,label:"数字"},model:{value:i.count,callback:function(e){t.$set(i,"count",t._n(e))},expression:"item.count"}})],1),a("i",{staticClass:"u-close el-icon-circle-close",on:{click:function(t){return e.data.splice(n,1)}}})],1)})):a("div",{staticClass:"u-normal"},[t._v("拖拽所需道具到此处")])],2)],1)])})),1):a("el-row",{staticClass:"u-list-box u-list-equip",attrs:{gutter:20}},t._l(t.equipList,(function(e,i){return a("el-col",{key:i,attrs:{span:6}},t._l(e,(function(e,i){return a("div",{key:i,staticClass:"u-list"},[a("div",{staticClass:"u-title"},[t._v(t._s(e.label))]),a("draggable",{attrs:{list:e.list,move:t.moveHandle,"data-AucGenre":e.AucGenre,"data-AucSubType":e.AucSubType,group:"draggable-item","ghost-class":"ghost"}},[e.list&&e.list.length?t._l(e.list,(function(i,n){return a("div",{key:n,staticClass:"u-selected u-selected-item u-selected-equip"},["string"==typeof i?a("itemIcon",{staticClass:"u-icon",attrs:{item_id:i}}):t._e(),"object"==typeof i?a("itemIcon",{staticClass:"u-icon",attrs:{item:i}}):t._e(),a("i",{staticClass:"u-close el-icon-circle-close",on:{click:function(t){return e.list.splice(n,1)}}})],1)})):a("div",{staticClass:"u-normal"},[t._v("拖拽所需道具到此处")])],2)],1)})),0)})),1)],1)]),a("el-form-item",[a("el-button",{staticClass:"u-publish",attrs:{icon:"el-icon-s-promotion",type:"primary",loading:t.loading},on:{click:t.submit}},[t._v("提交物品清单")])],1)],1)],1)}),[],!1,null,"2678cd78",null));e.default=v.exports},ef77:function(t,e,a){"use strict";var i={name:"publish_header",props:["name"],data:function(){return{}},computed:{},methods:{goBack:function(){window.history.length?this.$router.go(-1):this.$router.push("/")}},mounted:function(){},components:{}},n=(a("bec3"),a("2877")),s=Object(n.a)(i,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"m-publish-header"},[e("el-page-header",{attrs:{content:this.name},on:{back:this.goBack}}),this._t("default")],2)}),[],!1,null,null,null);e.a=s.exports},f917:function(t,e,a){},ff79:function(t,e,a){"use strict";a("5241")}}]);
//# sourceMappingURL=chunk-4135f528.b6f14f84.js.map
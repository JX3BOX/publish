(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2ab831d4"],{"0711":function(t,e,s){"use strict";var i={name:"",props:["data"],components:{},data:function(){return{visible:"0"}},model:{prop:"data",event:"update"},watch:{data:function(t){this.visible=t},visible:{deep:!0,handler:function(t){this.$emit("update",t)}}},computed:{},methods:{},filters:{},created:function(){},mounted:function(){}},n=(s("9b2a"),s("2877")),a=Object(n.a)(i,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-visible"},[e("el-form-item",{attrs:{label:"阅读权限"}},[e("el-radio-group",{model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("el-radio",{attrs:{label:"0"}},[t._v("公开")]),e("el-radio",{attrs:{label:"1"}},[t._v("仅自己可见")]),e("el-radio",{attrs:{label:"2"}},[t._v("仅亲友可见")]),e("el-radio",{attrs:{label:"3",disabled:""}},[t._v("密码可见")]),e("el-radio",{attrs:{label:"4",disabled:""}},[t._v("付费可见")]),e("el-radio",{attrs:{label:"5",disabled:""}},[t._v("粉丝可见")])],1)],1)],1)}),[],!1,null,"509226a0",null);e.a=a.exports},"0d05":function(t,e,s){"use strict";s("3a7f")},"18db":function(t,e,s){},"354c":function(t,e,s){},"3a7f":function(t,e,s){},"3c49":function(t,e,s){"use strict";s.d(e,"a",(function(){return c}));var i=s("c7eb"),n=s("1da1"),a=(s("b64b"),s("99af"),s("41cb"));var o,l=s("c9d2"),c={data:function(){return{isSuperAuthor:!1}},computed:{userInfo:function(){return l.a.getInfo()}},mounted:function(){var t=this;return Object(n.a)(Object(i.a)().mark((function e(){return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.isSuperAuthor();case 2:t.isSuperAuthor=e.sent;case 3:case"end":return e.stop()}}),e)})))()},methods:{atUser:(o=Object(n.a)(Object(i.a)().mark((function t(e){var s;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(s=sessionStorage.getItem("atAuthor"))){t.next=6;break}return t.next=5,i={sendUserId:this.userInfo.uid,accessUserId:JSON.parse(s),postId:e||this.id,postType:this.post_type||this.post.post_type},n=void 0,o=void 0,l=void 0,c=void 0,n=i.sendUserId,o=i.accessUserId,l=i.postId,c=i.postType,Object(a.e)({mute:!0}).get("/api/horn/".concat(n,"/to/user/article/").concat(c,"/").concat(l),{params:{accessUserId:o}});case 5:sessionStorage.removeItem("atAuthor");case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}var i,n,o,l,c}),t,this,[[0,8]])}))),function(t){return o.apply(this,arguments)})}}},"3ecd":function(t,e,s){"use strict";var i={name:"publish_gift",props:["data"],data:function(){return{allow_gift:this.data}},model:{prop:"data",event:"update"},watch:{data:function(t){this.allow_gift=t},allow_gift:{deep:!0,handler:function(t){this.$emit("update",t)}}}},n=s("2877"),a=Object(n.a)(i,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-comment"},[e("el-form-item",{attrs:{label:"礼物开关"}},[e("el-switch",{attrs:{"active-color":"#13ce66","active-value":1,"inactive-value":0},model:{value:t.allow_gift,callback:function(e){t.allow_gift=e},expression:"allow_gift"}})],1),t._t("default")],2)}),[],!1,null,null,null);e.a=a.exports},4618:function(t,e,s){"use strict";var i={name:"publish_subtype",props:["data","options","lock"],data:function(){return{subtype:this.data,subtypes:this.options||[]}},model:{prop:"data",event:"update"},watch:{data:function(t){this.subtype=t},subtype:{deep:!0,handler:function(t){this.$emit("update",t)}},options:{deep:!0,handler:function(t){t&&(this.subtypes=t)}}},computed:{frozen:function(){return this.lock}},methods:{},mounted:function(){},components:{}},n=s("2877"),a=Object(n.a)(i,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-subtype"},[e("el-form-item",{attrs:{label:"类型"}},[e("el-radio-group",{model:{value:t.subtype,callback:function(e){t.subtype=e},expression:"subtype"}},t._l(t.subtypes,(function(s,i){return e("el-radio",{key:i,attrs:{label:i,border:"",disabled:t.frozen&&t.$route.params.id&&t.subtype!=i}},[t._v(t._s(s))])})),1)],1),t._t("default")],2)}),[],!1,null,null,null);e.a=a.exports},"505f":function(t,e,s){"use strict";var i=s("52da"),n={name:"publish_client",props:["data","forbidAll","showMobile"],data:function(){return{client:this.data}},model:{prop:"data",event:"update"},watch:{data:function(t){this.client=t},client:{deep:!0,handler:function(t){this.$emit("update",t)}}},computed:{},methods:{handleChange:function(){i.a.$emit("changeClient",this.client)}},mounted:function(){},components:{}},a=s("2877"),o=Object(a.a)(n,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-client"},[e("el-form-item",{attrs:{label:"版本"}},[e("el-radio-group",{on:{change:t.handleChange},model:{value:t.client,callback:function(e){t.client=e},expression:"client"}},[e("el-radio",{attrs:{label:"std"}},[t._v("剑三")]),e("el-radio",{attrs:{label:"origin"}},[t._v("缘起")]),t.forbidAll?t._e():e("el-radio",{attrs:{label:"all"}},[t._v("全端")])],1)],1),t._t("default")],2)}),[],!1,null,null,null);e.a=o.exports},"52da":function(t,e,s){"use strict";var i=new(s("2b0e").default);e.a=i},"5c9c":function(t){t.exports=JSON.parse('{"1":"运营活动","2":"公告动态","3":"功能更新","4":"兑换通知"}')},"5dfe":function(t,e,s){"use strict";s.r(e);var i=s("2909"),n=(s("14d9"),s("d3b7"),s("85e4")),a=s("5c9c"),o=s("221a"),l=s("ef77"),c=s("d0a1"),r=s("505f"),u=s("adff"),p=(s("b13e"),s("cc72")),d=s("3ecd"),f=s("0711"),h=s("4618"),m=s("db12"),b=s("af05"),v=s("3c49"),_=s("c402"),g={name:"notice",components:{Tinymce:o.a,"publish-header":l.a,"publish-title":c.a,"publish-client":r.a,"publish-excerpt":u.a,"publish-comment":p.a,"publish-gift":d.a,"publish-visible":f.a,"publish-subtype":h.a,"publish-authors":m.a,"publish-at-authors":b.a},mixins:[v.a],data:function(){return{loading:!1,processing:!1,post:{ID:"",post_status:"publish",post_type:"notice",post_title:"",post_subtype:"1",post_meta:{},post_content:"",post_mode:"tinymce",original:0,client:"std",lang:"cn",zlp:"",post_excerpt:"",post_banner:"",post_collection:"",comment:0,allow_gift:1,visible:0},notice_types:a}},computed:{id:function(){return this.isRevision?~~this.post.post_id:~~this.post.ID},data:function(){return this.id?[this.id,this.post]:[this.post]}},methods:{init:function(){var t=this;return this.loading=!0,sessionStorage.removeItem("atAuthor"),this.$route.params.id?Object(_.l)(this.$route.params.id).then((function(e){return t.post=e.data.data,e.data.data})).finally((function(){t.loading=!1})):new Promise((function(t,e){t()})).finally((function(){t.loading=!1}))},publish:function(t,e){var s=this;this.post.post_status=t,this.processing=!0,_.m.apply(void 0,Object(i.a)(this.data)).then((function(t){var i=t.data.data;s.atUser(i.ID),s.done(e,i)})).finally((function(){s.processing=!1}))},done:function(t,e){t?(this.$message({message:"发布成功",type:"success"}),setTimeout((function(){location.href=Object(n.f)(e.post_type,e.ID)}),500)):(this.$notify({title:"保存成功",message:"云端草稿保存成功",type:"success"}),this.post=e,this.$route.params.id||this.$router.push({params:{id:e.ID}}))}},created:function(){this.post.client=this.$store.state.client,this.init()},watch:{"$route.params.id":function(t){t&&this.init()}}},x=s("2877"),y=Object(x.a)(g,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-publish-box"},[e("publish-header",{attrs:{name:"公告资讯"}}),e("el-form",{attrs:{"label-position":"left","label-width":"80px"}},[e("publish-title",{model:{value:t.post.post_title,callback:function(e){t.$set(t.post,"post_title",e)},expression:"post.post_title"}}),e("div",{staticClass:"m-publish-info"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("信息")]),e("publish-client",{model:{value:t.post.client,callback:function(e){t.$set(t.post,"client",e)},expression:"post.client"}}),e("publish-subtype",{attrs:{options:t.notice_types},model:{value:t.post.post_subtype,callback:function(e){t.$set(t.post,"post_subtype",e)},expression:"post.post_subtype"}})],1),e("div",{staticClass:"m-publish-content"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("正文")]),e("Tinymce",{directives:[{name:"show",rawName:"v-show",value:!t.post.post_mode||"tinymce"==t.post.post_mode,expression:"!post.post_mode || post.post_mode == 'tinymce'"}],attrs:{attachmentEnable:!0,resourceEnable:!0},model:{value:t.post.post_content,callback:function(e){t.$set(t.post,"post_content",e)},expression:"post.post_content"}})],1),e("div",{staticClass:"m-publish-append"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("附加")]),e("publish-excerpt",{model:{value:t.post.post_excerpt,callback:function(e){t.$set(t.post,"post_excerpt",e)},expression:"post.post_excerpt"}})],1),e("div",{staticClass:"m-publish-extend"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("设置")]),e("publish-comment",{model:{value:t.post.comment,callback:function(e){t.$set(t.post,"comment",e)},expression:"post.comment"}}),e("publish-gift",{model:{value:t.post.allow_gift,callback:function(e){t.$set(t.post,"allow_gift",e)},expression:"post.allow_gift"}}),e("publish-visible",{model:{value:t.post.visible,callback:function(e){t.$set(t.post,"visible",e)},expression:"post.visible"}}),e("publish-authors",{attrs:{id:t.id,uid:t.post.post_author}})],1),e("div",{staticClass:"m-publish-extend"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("临时")]),e("publish-at-authors")],1),t.isSuperAuthor?e("div",{staticClass:"m-publish-other"},[e("cms-banner",{model:{value:t.post.post_banner,callback:function(e){t.$set(t.post,"post_banner",e)},expression:"post.post_banner"}}),e("publish-design-task",{attrs:{data:t.post}})],1):t._e(),e("div",{staticClass:"m-publish-buttons"},[e("el-button",{attrs:{type:"primary",disabled:t.processing},on:{click:function(e){return t.publish("publish",!0)}}},[t._v("发    布")]),e("el-button",{attrs:{type:"plain",disabled:t.processing},on:{click:function(e){return t.publish("draft",!1)}}},[t._v("保存为草稿")])],1)],1)],1)}),[],!1,null,null,null);e.default=y.exports},"647d":function(t,e,s){"use strict";s.d(e,"c",(function(){return n})),s.d(e,"d",(function(){return a})),s.d(e,"a",(function(){return l})),s.d(e,"b",(function(){return o})),s.d(e,"f",(function(){return c})),s.d(e,"e",(function(){return r}));s("99af");var i=s("41cb");function n(t){return Object(i.a)().get("/api/cms/posts/user/my/union",{params:t})}function a(t){return Object(i.a)().delete("/api/cms/post/".concat(t,"/authors/quit"))}function o(t){return Object(i.a)().get("/api/cms/post/".concat(t,"/authors"))}function l(t,e){return Object(i.a)().post("/api/cms/post/".concat(t,"/author/").concat(e),{label:"撰稿",r_edit:1})}function c(t,e,s){return Object(i.a)().put("/api/cms/post/".concat(t,"/author/").concat(e),s)}function r(t,e){return Object(i.a)().delete("/api/cms/post/".concat(t,"/author/").concat(e))}},"6f18":function(t,e,s){"use strict";s("354c")},"7f6e":function(t,e,s){},"9b2a":function(t,e,s){"use strict";s("f4b8")},adff:function(t,e,s){"use strict";var i={name:"publish_excerpt",props:["data"],data:function(){return{excerpt:this.data}},model:{prop:"data",event:"update"},watch:{data:function(t){this.excerpt=t},excerpt:{deep:!0,handler:function(t){this.$emit("update",t)}}},computed:{},methods:{},mounted:function(){},components:{}},n=(s("0d05"),s("2877")),a=Object(n.a)(i,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-excerpt"},[e("el-input",{attrs:{maxlength:200,"show-word-limit":"",type:"textarea",placeholder:"摘要信息"},model:{value:t.excerpt,callback:function(e){t.excerpt=e},expression:"excerpt"}}),t._t("default")],2)}),[],!1,null,"3228f028",null);e.a=a.exports},af05:function(t,e,s){"use strict";s("a15b"),s("a434"),s("e9c4"),s("b64b");var i=s("9a1b"),n=s("85e4"),a={name:"publish_at_authors",data:function(){return{authorIds:[],list:[]}},mounted:function(){window.addEventListener("setItemEvent",this.handleSession)},beforeDestroy:function(){window.removeEventListener("setItemEvent",this.handleSession)},watch:{authorIds:{deep:!0,handler:function(t,e){t.length>e.length&&this.loadUsers()}}},methods:{handleSession:function(t){if("atAuthor"===t.key)try{var e=JSON.parse(t.newVal);this.authorIds=e}catch(t){console.log(t),this.authorIds=[]}},loadUsers:function(){var t=this;Object(i.b)(this.authorIds).then((function(e){t.list=e.data.data}))},remove:function(t,e){var s=this.authorIds.split(",");s.splice(e,1),this.list.splice(e,1),s.length?sessionStorage.setItem("atAuthor",JSON.stringify(s.join(","))):sessionStorage.removeItem("atAuthor")}},filters:{showAvatar:function(t){return Object(n.m)(t)}}},o=(s("e87f"),s("2877")),l=Object(o.a)(a,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-authors"},[e("el-form-item",{attrs:{label:"@圈一下"}},[e("div",{staticClass:"u-list"},t._l(t.list,(function(s,i){return e("div",{key:i,staticClass:"u-item"},[e("img",{staticClass:"u-avatar",attrs:{src:t._f("showAvatar")(s.user_avatar)}}),e("span",{staticClass:"u-name"},[t._v(" "+t._s(s.display_name)+" ")]),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"移除",placement:"top"}},[e("i",{staticClass:"u-delete el-icon-delete",on:{click:function(e){return t.remove(s,i)}}})])],1)})),0)])],1)}),[],!1,null,"07522ff3",null);e.a=l.exports},b3aa:function(t,e,s){},b4e5:function(t,e,s){"use strict";s("b3aa")},b6e6:function(t,e,s){"use strict";s("7f6e")},cc72:function(t,e,s){"use strict";var i={name:"publish_comment",props:["data"],data:function(){return{comment:this.data}},model:{prop:"data",event:"update"},watch:{data:function(t){this.comment=t},comment:{deep:!0,handler:function(t){this.$emit("update",t)}}},computed:{},methods:{},mounted:function(){},components:{}},n=(s("b6e6"),s("2877")),a=Object(n.a)(i,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-comment"},[e("el-form-item",{attrs:{label:"评论开关"}},[e("el-switch",{attrs:{"active-color":"#13ce66","active-value":0,"inactive-value":1},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1),e("div",{staticClass:"m-comment-extend"},[t._t("default")],2)],1)}),[],!1,null,"ca3e4fc0",null);e.a=a.exports},d0a1:function(t,e,s){"use strict";var i={name:"publish_title",props:["data","hideDiv","placeholder"],data:function(){return{title:this.data}},model:{prop:"data",event:"update"},watch:{data:function(t){this.title=t},title:{deep:!0,handler:function(t){this.$emit("update",t)}}},computed:{},methods:{},mounted:function(){},components:{}},n=s("2877"),a=Object(n.a)(i,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-title"},[t.hideDiv?t._e():e("el-divider",{attrs:{"content-position":"left"}},[t._v("标题")]),e("el-input",{attrs:{maxlength:50,minlength:2,"show-word-limit":"",required:"",placeholder:t.placeholder||"请填写标题"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t._t("default")],2)}),[],!1,null,null,null);e.a=a.exports},db12:function(t,e,s){"use strict";s("14d9"),s("a434");var i=s("1dfe"),n=s("647d"),a=s("85e4"),o=s("c9d2"),l={name:"PublishAuthors",props:["id","uid"],components:{UserPop:i.a},data:function(){return{list:[],visible:!1}},computed:{isSuper:function(){return o.a.getInfo().uid==this.uid}},watch:{id:{immediate:!0,handler:function(t){t&&this.loadAuthors()}}},methods:{openPop:function(){this.visible=!0},addAuthor:function(t){var e=this;Object(n.a)(this.id,t.ID).then((function(s){e.$notify({title:"添加成功",message:"联合创作者添加成功",type:"success"}),e.list.push({post_author_info:t,label:"撰稿",status:0})}))},loadAuthors:function(){var t=this;Object(n.b)(this.id).then((function(e){var s,i;t.list=null===(s=e.data)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.other_authors}))},update:function(t){var e=this;this.$prompt("修改展示项，例如：撰稿/修订/主创/校稿..","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(s){var i=s.value;Object(n.f)(e.id,t.post_author_info.ID,{label:i,r_edit:1}).then((function(){t.label=i,e.$notify({title:"修改成功",message:"备注更新成功",type:"success"})}))}))},remove:function(t,e){var s=this;Object(n.e)(this.id,t.post_author_info.ID).then((function(t){s.$notify({title:"删除成功",message:"成功移除联合创作者",type:"success"}),s.list.splice(e,1)}))}},filters:{showAvatar:function(t){return Object(a.m)(t)}},created:function(){},mounted:function(){}},c=(s("6f18"),s("2877")),r=Object(c.a)(l,(function(){var t=this,e=t._self._c;return t.id&&t.isSuper?e("div",{staticClass:"m-publish-authors"},[e("el-form-item",{attrs:{label:"联合创作"}},[e("div",{staticClass:"u-list"},[t._l(t.list,(function(s,i){return e("div",{key:i,staticClass:"u-item"},[s.status?t._e():e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"等待被邀请者确认",placement:"top"}},[e("i",{staticClass:"u-status el-icon-loading"})]),e("img",{staticClass:"u-avatar",attrs:{src:t._f("showAvatar")(s.post_author_info.user_avatar)}}),e("span",{staticClass:"u-name"},[t._v(" "+t._s(s.post_author_info.display_name)+" "),e("span",{staticClass:"u-label"},[t._v("("+t._s(s.label||"撰稿")+")")])]),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"修改备注",placement:"top"}},[e("i",{staticClass:"u-edit el-icon-edit",on:{click:function(e){return t.update(s)}}})]),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"移除",placement:"top"}},[e("i",{staticClass:"u-delete el-icon-delete",on:{click:function(e){return t.remove(s,i)}}})])],1)})),e("el-button",{attrs:{plain:"",size:"small",type:"primary"},on:{click:t.openPop}},[t._v("+ 添加联合创作者")])],2),e("UserPop",{attrs:{title:"添加用户"},on:{confirm:t.addAuthor},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}})],1)],1):t._e()}),[],!1,null,null,null);e.a=r.exports},e87f:function(t,e,s){"use strict";s("18db")},ef77:function(t,e,s){"use strict";s("b0c0"),s("14d9");var i={name:"publish_header",props:["name"],data:function(){return{}},computed:{},methods:{goBack:function(){window.history.length?this.$router.go(-1):this.$router.push("/")}},mounted:function(){},components:{}},n=(s("b4e5"),s("2877")),a=Object(n.a)(i,(function(){var t=this._self._c;return t("div",{staticClass:"m-publish-header"},[t("el-page-header",{attrs:{content:this.name},on:{back:this.goBack}}),this._t("default")],2)}),[],!1,null,null,null);e.a=a.exports},f4b8:function(t,e,s){}}]);
//# sourceMappingURL=chunk-2ab831d4.0cad65a2.js.map
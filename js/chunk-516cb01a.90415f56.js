(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-516cb01a"],{34082:function(t,e,i){"use strict";i("6f23")},"61d5":function(t,e,i){},"6f23":function(t,e,i){},bec3:function(t,e,i){"use strict";i("61d5")},e4f6:function(t,e,i){"use strict";i.d(e,"g",(function(){return s})),i.d(e,"c",(function(){return l})),i.d(e,"i",(function(){return n})),i.d(e,"e",(function(){return o})),i.d(e,"a",(function(){return c})),i.d(e,"k",(function(){return u})),i.d(e,"h",(function(){return r})),i.d(e,"j",(function(){return d})),i.d(e,"d",(function(){return p})),i.d(e,"f",(function(){return m})),i.d(e,"b",(function(){return h}));var a=i("41cb");function s(t){return Object(a.b)().post("/api/cms/post/emotion",t)}function n(t,e){return Object(a.b)().put("/api/cms/post/emotion/".concat(t),e)}function l(t){return Object(a.b)().get("/api/cms/post/emotion/".concat(t))}function o(t){return Object(a.b)().get("/api/cms/post/emotions/my",{params:t})}function c(t){return Object(a.b)().delete("/api/cms/post/emotion/".concat(t))}function u(t){return Object(a.b)().post("/api/cms/upload",t)}function r(t){return Object(a.d)().post("/api/joke/share",t)}function d(t){return Object(a.d)().put("/api/joke/share/".concat(t.id),t)}function p(t){return Object(a.b)().get("/api/cms/post/joke/".concat(t))}function m(t){return Object(a.b)().get("/api/cms/post/jokes/my",{params:t})}function h(t){return Object(a.b)().delete("/api/cms/post/joke/".concat(t))}},ef77:function(t,e,i){"use strict";var a={name:"publish_header",props:["name"],data:function(){return{}},computed:{},methods:{goBack:function(){window.history.length?this.$router.go(-1):this.$router.push("/")}},mounted:function(){},components:{}},s=(i("bec3"),i("2877")),n=Object(s.a)(a,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"m-publish-header"},[e("el-page-header",{attrs:{content:this.name},on:{back:this.goBack}}),this._t("default")],2)}),[],!1,null,null,null);e.a=n.exports},f18d:function(t,e,i){"use strict";i.r(e);i("d3b7"),i("159b"),i("b0c0"),i("99af"),i("a434");var a=i("85e4"),s=i("33a5"),n=i("65c2"),l=i("ef77"),o=i("9530"),c=i("e4f6"),u={name:"emotion",components:{UploadImages:o.a,"publish-header":l.a},data:function(){return{loading:!1,processing:!1,schoolmap:s,supportTypes:"image/png, image/jpeg, image/gif, image/bmp, image/webp",list:[],data:{},dialogImageUrl:"",dialogVisible:!1}},computed:{id:function(){return~~this.$route.params.id},fileInput:function(){return this.$refs.uploadInput}},methods:{init:function(){var t=this;this.loading=!0,Object(c.c)(this.id).then((function(e){var i;t.data=null==e||null===(i=e.data)||void 0===i?void 0:i.data})).finally((function(){t.loading=!1}))},updateFileList:function(t){var e=t.list,i=[];e.forEach((function(t){t.is_img&&i.push({desc:t.name,url:t.url,original:0,author:"",type:""})})),this.list=this.list.concat(i)},previewHandle:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},deleteHandle:function(t){this.list.splice(t,1)},publish:function(){var t=this;this.processing=!0,Object(c.g)(this.list).then((function(e){t.$message({message:"发布成功,请等待审核",type:"success"}),setTimeout((function(){location.href=Object(a.getLink)("emotion")}),500)})).finally((function(){t.processing=!1}))},update:function(){var t,e=this;null!==(t=this.data)&&void 0!==t&&t.url?(this.processing=!0,Object(c.i)(this.id,this.data).then((function(t){e.$message({message:"更新成功,请等待审核",type:"success"}),setTimeout((function(){location.href=Object(a.getLink)("emotion",e.id)}),500)})).finally((function(){e.processing=!1}))):this.$message({message:"图片不能为空",type:"warning"})},removePic:function(){this.data.url=""},select:function(){this.fileInput.dispatchEvent(new MouseEvent("click"))},upload:function(){var t=this,e=new FormData;e.append("file",this.fileInput.files[0]),Object(c.k)(e).then((function(e){t.data.url=e.data.data[0],t.$message({message:"上传成功",type:"success"}),t.fileInput.files=[]}))},handleRemove:function(){this.data.url=""}},watch:{"$route.params.id":{immediate:!0,handler:function(t){t&&this.init()}}},filters:{showThumbnail:function(t){return Object(a.getThumbnail)(t,146)},showSchoolIcon:function(t){return n.__imgPath+"image/school/"+t+".png"}}},r=(i("34082"),i("2877")),d=Object(r.a)(u,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-publish-box m-publish-box-emotion"},[i("publish-header",{attrs:{name:"剑三表情"}}),i("el-form",{attrs:{"label-position":"left","label-width":"80px"}},[t.id?i("div",{staticClass:"m-publish-emotion m-publish-emotion-edit"},[i("el-form-item",{attrs:{label:"图片"}},[t.data&&t.data.url?i("div",{staticClass:"u-pic"},[i("img",{staticClass:"u-img",attrs:{src:t._f("showThumbnail")(t.data.url)}}),i("i",{staticClass:"u-mask"}),i("i",{staticClass:"u-preview",on:{click:function(e){return t.previewHandle(t.data)}}},[i("i",{staticClass:"el-icon-zoom-in"})])]):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.data.url,expression:"!data.url"}],staticClass:"m-emotion-upload"},[t.data&&t.data.url?i("div",{staticClass:"u-emotion"},[i("img",{attrs:{src:t.data.url}}),i("i",{staticClass:"u-emotion-mask"}),i("i",{staticClass:"u-emotion-delete el-icon-delete",attrs:{title:"移除"},on:{click:t.handleRemove}})]):i("div",{staticClass:"u-upload el-upload el-upload--picture-card",on:{click:t.select}},[i("i",{staticClass:"el-icon-plus"})]),i("input",{ref:"uploadInput",staticClass:"u-upload-input",attrs:{type:"file"},on:{change:t.upload}})]),t.data&&t.data.url?i("el-button",{staticClass:"u-remove-btn",attrs:{icon:"el-icon-delete",size:"mini"},on:{click:t.removePic}},[t._v("移除")]):t._e()],1),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{attrs:{maxlength:120,"show-word-limit":"",placeholder:"图片说明"},model:{value:t.data.desc,callback:function(e){t.$set(t.data,"desc",e)},expression:"data.desc"}})],1),i("el-form-item",{attrs:{label:"类别"}},[i("el-select",{attrs:{placeholder:"选择门派（非必选）"},model:{value:t.data.type,callback:function(e){t.$set(t.data,"type",e)},expression:"data.type"}},t._l(t.schoolmap,(function(e,a){return i("el-option",{key:a,attrs:{value:a,label:e}},[i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("img",{staticClass:"u-icon",staticStyle:{"margin-right":"20px"},attrs:{width:"24",height:"24",src:t._f("showSchoolIcon")(a),alt:e}}),t._v(" "+t._s(e)+" ")])])})),1)],1),i("el-form-item",{attrs:{label:"原创"}},[i("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.data.original,callback:function(e){t.$set(t.data,"original",t._n(e))},expression:"data.original"}})],1),i("el-form-item",{attrs:{label:"原作者"}},[i("el-input",{attrs:{placeholder:"（非必填）"},model:{value:t.data.author,callback:function(e){t.$set(t.data,"author",e)},expression:"data.author"}})],1),i("div",{staticClass:"m-publish-buttons"},[i("el-button",{attrs:{type:"primary",disabled:t.processing},on:{click:t.update}},[t._v("更    新")])],1)],1):i("div",{staticClass:"m-publish-emotion m-publish-emotion-create"},[i("div",{staticClass:"m-publish-emotion-bulk"},[i("h1",{staticClass:"u-title"},[t._v("上传表情")]),i("UploadImages",{attrs:{text:"批量上传图片",onlyImage:!0,desc:"一次最多同时上传10个文件（不超过5M）",accept:t.supportTypes},on:{insert:t.updateFileList}}),i("div",{staticClass:"u-tip"},[i("i",{staticClass:"el-icon-info"}),t._v(" 图片格式支持gif/png/jpg/bmp/webp ")])],1),t.list&&t.list.length?i("div",{staticClass:"m-publish-emotion-list"},[i("div",{staticClass:"u-list"},t._l(t.list,(function(e,a){return i("div",{key:a,staticClass:"u-item"},[i("div",{staticClass:"u-div"},[i("i",{staticClass:"u-order"},[t._v(t._s(a+1))]),i("div",{staticClass:"u-op"},[i("el-button",{staticClass:"u-delete",attrs:{icon:"el-icon-delete",type:"info",size:"mini"},on:{click:function(e){return t.deleteHandle(a)}}},[t._v("删除")])],1)]),i("div",{staticClass:"u-pic"},[i("img",{staticClass:"u-img",attrs:{src:t._f("showThumbnail")(e.url)}}),i("i",{staticClass:"u-mask"}),i("i",{staticClass:"u-preview",on:{click:function(i){return t.previewHandle(e)}}},[i("i",{staticClass:"el-icon-zoom-in"})])]),i("div",{staticClass:"u-desc"},[i("el-input",{attrs:{maxlength:120,"show-word-limit":"",placeholder:"图片说明"},model:{value:e.desc,callback:function(i){t.$set(e,"desc",i)},expression:"item.desc"}},[i("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("描述")])])],1),i("div",{staticClass:"u-extend"},[i("el-switch",{attrs:{"inactive-text":"原创","active-value":1,"inactive-value":0},model:{value:e.original,callback:function(i){t.$set(e,"original",t._n(i))},expression:"item.original"}}),e.original?t._e():i("el-input",{staticClass:"u-author",attrs:{placeholder:"（非必填）",size:"mini"},model:{value:e.author,callback:function(i){t.$set(e,"author",i)},expression:"item.author"}},[i("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("原作者")])]),i("el-select",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",placeholder:"请选择门派（非必选）"},model:{value:e.type,callback:function(i){t.$set(e,"type",i)},expression:"item.type"}},t._l(t.schoolmap,(function(a,s){return i("el-option",{key:s,attrs:{value:s,label:a}},[i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("img",{staticClass:"u-icon",staticStyle:{"margin-right":"20px"},attrs:{width:"24",height:"24",src:t._f("showSchoolIcon")(s),alt:e}}),t._v(" "+t._s(a)+" ")])])})),1)],1)])})),0),i("div",{staticClass:"m-publish-buttons"},[i("el-button",{attrs:{type:"primary",disabled:t.processing},on:{click:t.publish}},[t._v("发    布")])],1)]):t._e()])]),i("el-dialog",{staticClass:"m-publish-emotion-preview",attrs:{visible:t.dialogVisible,title:"预览"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{src:t.dialogImageUrl}})])],1)}),[],!1,null,null,null);e.default=d.exports}}]);
//# sourceMappingURL=chunk-516cb01a.90415f56.js.map
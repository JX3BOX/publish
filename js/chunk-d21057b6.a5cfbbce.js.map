{"version":3,"sources":["webpack:///./src/post/knowledge.vue?e2ff","webpack:///./src/components/publish_header.vue?17ab","webpack:///./src/service/knowledge.js","webpack:///src/post/knowledge.vue","webpack:///./src/post/knowledge.vue?e8f1","webpack:///./src/post/knowledge.vue?16b7","webpack:///./src/post/knowledge.vue","webpack:///./src/components/publish_header.vue?814f","webpack:///src/components/publish_header.vue","webpack:///./src/components/publish_header.vue?3a87","webpack:///./src/components/publish_header.vue"],"names":["get_list","params","$helper","method","url","name","data","action","isEditMode","types","options","sources","loading","knowledge","type","currentSource","processing","post","id","content","source_id","remark","tags","inputVisible","inputValue","computed","_this$post","client","$store","state","methods","loadData","_this","wiki","get","supply","then","res","_res$data","_res$data$data","_res$data2","_res$data2$data","source","loadTypes","_this2","menus","loadSources","_this3","keyword","arguments","length","undefined","include_pending","limit","finally","resetSource","handleSubmit","_this4","createPost","createSource","_this5","qs","stringify","selectSource","validate","_this6","result","every","prop","$message","error","_this7","String","user_nickname","User","getInfo","code","message","concat","handleInputConfirm","trim","push","showInput","_this8","$nextTick","_","$refs","saveTagInput","input","focus","watch","immediate","handler","val","components","header","Tinymce","component","_vm","this","_c","_self","staticClass","attrs","_t","_v","model","value","callback","$$v","expression","$set","_l","key","label","on","item","domProps","_s","tag","$event","splice","ref","nativeOn","indexOf","_k","keyCode","apply","props","goBack","window","history","$router","go","mounted"],"mappings":"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","file":"js/chunk-d21057b6.a5cfbbce.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./knowledge.vue?vue&type=style&index=0&id=759cd926&prod&scoped=true&lang=less&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=style&index=0&id=36319e52&prod&lang=less&\"","import { $helper } from \"@jx3box/jx3box-common/js/https.js\";\nimport qs from \"qs\";\n\nfunction get_menus() {\n    return $helper()({\n        method: \"GET\",\n        url: `/api/knowledge/menus`,\n    });\n}\n\nfunction get_list(params) {\n    return $helper()({\n        method: \"GET\",\n        url: `/api/knowledges`,\n        params: params,\n    });\n}\n\nfunction create_knowledge(params) {\n    return $helper()({\n        method: \"POST\",\n        url: `/api/knowledge`,\n        data: qs.stringify({ knowledge: params }),\n    });\n}\n\nexport { get_menus, get_list, create_knowledge };\n","<template>\n    <div class=\"m-publish-box\">\n        <!-- 头部 -->\n        <publish-header name=\"通识百科\">\n            <slot name=\"header\"></slot>\n        </publish-header>\n\n        <el-form class=\"m-publish-post\">\n            <div class=\"m-publish-source\">\n                <el-divider content-position=\"left\">选择通识 *</el-divider>\n                <el-radio-group class=\"m-publish-action\" v-model=\"action\">\n                    <el-radio-button label=\"new\" :disabled=\"isEditMode\">新建词条</el-radio-button>\n                    <el-radio-button label=\"update\">维护已有词条</el-radio-button>\n                </el-radio-group>\n\n                <!-- 编辑模式 -->\n                <el-input class=\"u-current-source\" v-if=\"isEditMode\" v-model=\"currentSource\" disabled></el-input>\n\n                <!-- 创建模式 -->\n                <template v-else>\n                    <template v-if=\"action == 'new'\">\n                        <!-- 创建词条 -->\n                        <div class=\"u-create-source\">\n                            <el-select\n                                class=\"u-source-type\"\n                                placeholder=\"选择通识类型\"\n                                v-model=\"knowledge.type\"\n                            >\n                                <el-option\n                                    v-for=\"type in types\"\n                                    :key=\"type.name\"\n                                    :value=\"type.name\"\n                                    :label=\"type.label\"\n                                ></el-option>\n                            </el-select>\n                            <el-input\n                                class=\"u-source-name\"\n                                placeholder=\"请输入通识名称\"\n                                v-model=\"knowledge.name\"\n                            ></el-input>\n                        </div>\n                        <p class=\"u-source-add-tip\">\n                            <span>Note：添加完成后的通识需要经过管理员审核通过后才会在通识百科上展示哦</span>\n                        </p>\n                    </template>\n                    <template v-else>\n                        <!-- 更新词条 -->\n                        <el-select\n                            class=\"u-source-id\"\n                            v-model.lazy=\"post.source_id\"\n                            filterable\n                            remote\n                            placeholder=\"通过输入通识名称进行搜索\"\n                            :remote-method=\"loadSources\"\n                            :loading=\"options.loading\"\n                            clearable\n                            @change=\"selectSource\"\n                        >\n                            <el-option v-for=\"item in options.sources\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\">\n                                <div class=\"u-option\">\n                                    <span class=\"u-type\" v-text=\"item.label\"></span>\n                                    <span class=\"u-name\" v-text=\"item.name\"></span>\n                                </div>\n                            </el-option>\n                        </el-select>\n                    </template>\n                </template>\n            </div>\n\n            <div class=\"m-publish-remark\">\n                <el-divider content-position=\"left\">修订说明 *</el-divider>\n                <el-input\n                    v-model=\"post.remark\"\n                    :maxlength=\"200\"\n                    :minlength=\"1\"\n                    show-word-limit\n                    required\n                    placeholder=\"请简单描述一下本次修订说明\"\n                ></el-input>\n            </div>\n\n            <div class=\"m-publish-content\">\n                <el-divider content-position=\"left\">通识正文 *</el-divider>\n                <Tinymce v-model=\"post.content\" :attachmentEnable=\"true\" :resourceEnable=\"true\" :height=\"600\" />\n            </div>\n\n            <div class=\"m-publish-tags\">\n                <el-divider content-position=\"left\">通识标签</el-divider>\n                <el-tag\n                    :key=\"key\"\n                    v-for=\"(tag, key) in post.tags\"\n                    closable\n                    :disable-transitions=\"false\"\n                    @close=\"post.tags.splice(key, 1)\"\n                    >{{ tag }}\n                </el-tag>\n                <el-input\n                    class=\"input-new-tag\"\n                    v-if=\"inputVisible\"\n                    v-model=\"inputValue\"\n                    ref=\"saveTagInput\"\n                    size=\"small\"\n                    placeholder=\"回车以添加\"\n                    @keyup.enter.native=\"handleInputConfirm\"\n                    @blur=\"handleInputConfirm\"\n                >\n                </el-input>\n                <el-button v-else class=\"button-new-tag\" size=\"small\" @click=\"showInput\">+ 添加标签 </el-button>\n            </div>\n\n            <div class=\"m-publish-commit\">\n                <el-divider content-position=\"left\"></el-divider>\n                <el-button\n                    class=\"u-publish\"\n                    icon=\"el-icon-s-promotion\"\n                    type=\"primary\"\n                    @click=\"handleSubmit\"\n                    :disabled=\"processing\"\n                    >提交通识\n                </el-button>\n            </div>\n        </el-form>\n    </div>\n</template>\n\n<script>\nimport header from \"@/components/publish_header.vue\";\nimport Tinymce from \"@jx3box/jx3box-editor/src/Tinymce\";\n\n// 本地依赖\n// import { WikiPost } from \"@jx3box/jx3box-common/js/helper\";\nimport { wiki } from \"@jx3box/jx3box-common/js/wiki\";\nimport User from \"@jx3box/jx3box-common/js/user\";\nimport { get_menus, get_list, create_knowledge } from \"../service/knowledge\";\n\nexport default {\n    name: \"knowledge\",\n    data() {\n        return {\n            // 用户动作\n            // ================\n            action: \"new\",\n            isEditMode: false,\n\n            // 通识信息\n            // =================\n            // 通识类别\n            types: [],\n            options: {\n                sources: [],\n                loading: false,\n            },\n            // 新建模式\n            knowledge: {\n                type: \"\",\n                name: \"\",\n            },\n            // 编辑模式\n            currentSource: \"\",\n\n            // 文章内容\n            // =================\n            processing: false,\n            post: {\n                id: \"\",\n                content: \"\",\n                source_id: \"\",\n                remark: \"\",\n                tags: [],\n            },\n\n            // 杂项\n            // =================\n            // 标签\n            inputVisible: false,\n            inputValue: \"\",\n\n        };\n    },\n    computed: {\n        source_id: function() {\n            return this.post?.source_id;\n        },\n        client: function (){\n            return this.$store.state.client;\n        }\n    },\n    methods: {\n        // 加载指定通识\n        loadData: function(id) {\n            if(!id) return\n            // WikiPost.newest(\"knowledge\", id, 0)\n            wiki.get({ type: \"knowledge\", id }, { supply: 0 })\n            .then((res) => {\n                // 设置通识\n                let source = res.data?.data?.source;\n                this.currentSource = source?.name;\n                this.post.source_id = source?.id\n\n                // 设置初始文章内容（基于最新审核版本）\n                let post = res.data?.data?.post;\n                this.post.content = post?.content || '';\n                this.post.tags = post?.tags || [];\n            });\n        },\n        // 加载可选类型\n        loadTypes: function() {\n            get_menus().then((res) => {\n                this.types = res.data.data.menus;\n            });\n        },\n        // 加载通识列表\n        loadSources(keyword = \"\") {\n            this.options.loading = true;\n            get_list({\n                keyword: keyword,\n                include_pending: 1,\n                limit: 10,\n            }).then((res) => {\n                this.options.sources = res.data.data.data;\n            }).finally(() => {\n                this.options.loading = false;\n            })\n        },\n        // 模式切换\n        resetSource : function (){\n            if(this.action == 'new'){\n\n                // 重置通识\n                this.post.source_id = ''\n                this.currentSource = ''\n\n                // 重置内容\n                this.post.content = ''\n                this.post.tags = []\n                this.post.remark = ''\n            }\n        },\n\n        // 发布流程\n        // ======================\n        handleSubmit: function() {\n            if (this.action == 'new' && !this.post.source_id) {\n                this.createSource().then(() => {\n                    // 当通识已存在时，后端会自动识别为同一条词条\n                    this.createPost();\n                });\n            } else {\n                this.createPost();\n            }\n        },\n\n        // 1.创建通识词条\n        createSource() {\n            this.processing = true;\n            return create_knowledge({\n                type: this.knowledge.type,\n                name: this.knowledge.name,\n                client: \"all\",\n            })\n                .then((res) => {\n                    this.post.source_id = res.data.data.id;\n                    // this.$message({\n                    //     message: `${res.message}`,\n                    //     type: \"warning\",\n                    // });\n                })\n                .finally(() => {\n                    this.processing = false;\n                });\n        },\n\n        // 2.维护已有通识\n        selectSource : function (source_id){\n            this.loadData(source_id)\n        },\n\n        // 3.校验字段\n        validate() {\n            let result = [\"source_id\", \"content\", \"remark\"].every((prop) => {\n                return !!this.post[prop];\n            });\n            if (!result) this.$message.error(\"请完成必填项\");\n            return result;\n        },\n        // 4.发布作品\n        createPost: function() {\n            // 表单校验\n            if (!this.validate()) return;\n            this.processing = true;\n            /* WikiPost.save({\n                type: \"knowledge\",\n                source_id: this.post.source_id,\n                user_nickname: User.getInfo().name,\n                content: this.post.content,\n                remark: this.post.remark,\n                tags: this.post.tags,\n                client : 'all'\n            }) */\n            const data = {\n                source_id: String(this.post.source_id),\n                user_nickname: User.getInfo().name,\n                content: this.post.content,\n                remark: this.post.remark,\n                tags: this.post.tags,\n            }\n            wiki.post({ type: 'knowledge', data: data, client: 'all' }, {})\n                .then((res) => {\n                    res = res.data;\n                    if (res.code === 200) {\n                        this.$message({ message: \"提交成功，请等待审核\", type: \"success\" });\n                        // setTimeout(() => {\n                        //     this.$router.push({ name: \"wiki_post\", params: { type: \"knowledge\" } });\n                        // }, 500);\n                    } else {\n                        this.$message({ message: `${res.message}`, type: \"warning\" });\n                    }\n                })\n                .finally(() => {\n                    this.processing = false;\n                });\n        },\n\n\n        // 标签\n        // =========================\n        handleInputConfirm() {\n            let inputValue = this.inputValue.trim();\n            if (inputValue) {\n                this.post.tags.push(inputValue);\n            }\n            this.inputVisible = false;\n            this.inputValue = \"\";\n        },\n        showInput() {\n            this.inputVisible = true;\n            this.$nextTick((_) => {\n                this.$refs.saveTagInput.$refs.input.focus();\n            });\n        },\n\n    },\n    watch: {\n        // 根据路由判定进入的模式\n        '$route.params.source_id': {\n            immediate: true,\n            handler: function(val) {\n                // 编辑模式\n                if (val) {\n                    this.action = \"update\";\n                    this.isEditMode = true;\n                    this.post.source_id = ~~val\n                    this.loadData(val)\n\n                // 创建模式\n                } else {\n                    this.action = \"new\";\n                    // 获取类型\n                    this.loadTypes();\n                    // 获取列表\n                    this.loadSources();\n                }\n            },\n        },\n        // 创建模式切换action\n        action : {\n            handler : function (){\n                if(!this.isEditMode){\n                    this.resetSource()\n                }\n            }\n        },\n        // 加载内容（维护已有）\n        source_id : function (val){\n            this.loadData(val);\n        }\n    },\n    components: {\n        \"publish-header\": header,\n        Tinymce,\n    },\n};\n</script>\n\n<style scoped lang=\"less\">\n@import \"../assets/css/knowledge.less\";\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./knowledge.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./knowledge.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./knowledge.vue?vue&type=template&id=759cd926&scoped=true&\"\nimport script from \"./knowledge.vue?vue&type=script&lang=js&\"\nexport * from \"./knowledge.vue?vue&type=script&lang=js&\"\nimport style0 from \"./knowledge.vue?vue&type=style&index=0&id=759cd926&prod&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"759cd926\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-publish-box\"},[_c('publish-header',{attrs:{\"name\":\"通识百科\"}},[_vm._t(\"header\")],2),_c('el-form',{staticClass:\"m-publish-post\"},[_c('div',{staticClass:\"m-publish-source\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"选择通识 *\")]),_c('el-radio-group',{staticClass:\"m-publish-action\",model:{value:(_vm.action),callback:function ($$v) {_vm.action=$$v},expression:\"action\"}},[_c('el-radio-button',{attrs:{\"label\":\"new\",\"disabled\":_vm.isEditMode}},[_vm._v(\"新建词条\")]),_c('el-radio-button',{attrs:{\"label\":\"update\"}},[_vm._v(\"维护已有词条\")])],1),(_vm.isEditMode)?_c('el-input',{staticClass:\"u-current-source\",attrs:{\"disabled\":\"\"},model:{value:(_vm.currentSource),callback:function ($$v) {_vm.currentSource=$$v},expression:\"currentSource\"}}):[(_vm.action == 'new')?[_c('div',{staticClass:\"u-create-source\"},[_c('el-select',{staticClass:\"u-source-type\",attrs:{\"placeholder\":\"选择通识类型\"},model:{value:(_vm.knowledge.type),callback:function ($$v) {_vm.$set(_vm.knowledge, \"type\", $$v)},expression:\"knowledge.type\"}},_vm._l((_vm.types),function(type){return _c('el-option',{key:type.name,attrs:{\"value\":type.name,\"label\":type.label}})}),1),_c('el-input',{staticClass:\"u-source-name\",attrs:{\"placeholder\":\"请输入通识名称\"},model:{value:(_vm.knowledge.name),callback:function ($$v) {_vm.$set(_vm.knowledge, \"name\", $$v)},expression:\"knowledge.name\"}})],1),_c('p',{staticClass:\"u-source-add-tip\"},[_c('span',[_vm._v(\"Note：添加完成后的通识需要经过管理员审核通过后才会在通识百科上展示哦\")])])]:[_c('el-select',{staticClass:\"u-source-id\",attrs:{\"filterable\":\"\",\"remote\":\"\",\"placeholder\":\"通过输入通识名称进行搜索\",\"remote-method\":_vm.loadSources,\"loading\":_vm.options.loading,\"clearable\":\"\"},on:{\"change\":_vm.selectSource},model:{value:(_vm.post.source_id),callback:function ($$v) {_vm.$set(_vm.post, \"source_id\", $$v)},expression:\"post.source_id\"}},_vm._l((_vm.options.sources),function(item){return _c('el-option',{key:item.id,attrs:{\"label\":item.name,\"value\":item.id}},[_c('div',{staticClass:\"u-option\"},[_c('span',{staticClass:\"u-type\",domProps:{\"textContent\":_vm._s(item.label)}}),_c('span',{staticClass:\"u-name\",domProps:{\"textContent\":_vm._s(item.name)}})])])}),1)]]],2),_c('div',{staticClass:\"m-publish-remark\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"修订说明 *\")]),_c('el-input',{attrs:{\"maxlength\":200,\"minlength\":1,\"show-word-limit\":\"\",\"required\":\"\",\"placeholder\":\"请简单描述一下本次修订说明\"},model:{value:(_vm.post.remark),callback:function ($$v) {_vm.$set(_vm.post, \"remark\", $$v)},expression:\"post.remark\"}})],1),_c('div',{staticClass:\"m-publish-content\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"通识正文 *\")]),_c('Tinymce',{attrs:{\"attachmentEnable\":true,\"resourceEnable\":true,\"height\":600},model:{value:(_vm.post.content),callback:function ($$v) {_vm.$set(_vm.post, \"content\", $$v)},expression:\"post.content\"}})],1),_c('div',{staticClass:\"m-publish-tags\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"通识标签\")]),_vm._l((_vm.post.tags),function(tag,key){return _c('el-tag',{key:key,attrs:{\"closable\":\"\",\"disable-transitions\":false},on:{\"close\":function($event){return _vm.post.tags.splice(key, 1)}}},[_vm._v(_vm._s(tag)+\" \")])}),(_vm.inputVisible)?_c('el-input',{ref:\"saveTagInput\",staticClass:\"input-new-tag\",attrs:{\"size\":\"small\",\"placeholder\":\"回车以添加\"},on:{\"blur\":_vm.handleInputConfirm},nativeOn:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\"))return null;return _vm.handleInputConfirm.apply(null, arguments)}},model:{value:(_vm.inputValue),callback:function ($$v) {_vm.inputValue=$$v},expression:\"inputValue\"}}):_c('el-button',{staticClass:\"button-new-tag\",attrs:{\"size\":\"small\"},on:{\"click\":_vm.showInput}},[_vm._v(\"+ 添加标签 \")])],2),_c('div',{staticClass:\"m-publish-commit\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}}),_c('el-button',{staticClass:\"u-publish\",attrs:{\"icon\":\"el-icon-s-promotion\",\"type\":\"primary\",\"disabled\":_vm.processing},on:{\"click\":_vm.handleSubmit}},[_vm._v(\"提交通识 \")])],1)])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./publish_header.vue?vue&type=script&lang=js&\"","<template>\n    <div class=\"m-publish-header\">\n        <el-page-header @back=\"goBack\" :content=\"name\"></el-page-header>\n        <slot></slot>\n    </div>\n</template>\n\n<script>\nexport default {\n    name: \"publish_header\",\n    props: [\"name\"],\n    data: function() {\n        return {\n        };\n    },\n    computed: {},\n    methods: {\n        goBack: function() {\n            if(window.history.length){\n                this.$router.go(-1);\n            }else{\n                this.$router.push('/')\n            }\n        },\n    },\n    mounted: function() {},\n    components: {\n    },\n};\n</script>\n\n<style lang=\"less\">\n    .m-publish-header{\n        .pr;\n    }\n    \n</style>","import { render, staticRenderFns } from \"./publish_header.vue?vue&type=template&id=36319e52&\"\nimport script from \"./publish_header.vue?vue&type=script&lang=js&\"\nexport * from \"./publish_header.vue?vue&type=script&lang=js&\"\nimport style0 from \"./publish_header.vue?vue&type=style&index=0&id=36319e52&prod&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-publish-header\"},[_c('el-page-header',{attrs:{\"content\":_vm.name},on:{\"back\":_vm.goBack}}),_vm._t(\"default\")],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}
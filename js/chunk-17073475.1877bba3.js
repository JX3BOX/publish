(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-17073475"],{7924:function(t,e,s){},"7c5f":function(t,e,s){"use strict";s.r(e);s("b0c0");var i=s("5530"),o=(s("14d9"),s("d3b7"),s("ac1f"),s("5319"),s("ef77")),n=s("221a"),a=s("500d"),l=s("c9d2"),r=s("41cb");function c(t){return Object(r.d)()({method:"GET",url:"/quests",params:t})}var u=s("2ef0"),p=s("85e4"),d={name:"quest",data:function(){return{options:{sources:null},post:{id:"",content:"",source_id:"",level:0,remark:""},loading:!1,processing:!1,latest:{},current:{}}},computed:{client:function(){return this.$store.state.client},id:function(){var t;return null===(t=this.$route.query)||void 0===t?void 0:t.post_id},isLatest:function(){var t,e,s,i;return!(null===(t=this.current)||void 0===t||null===(e=t.post)||void 0===e||!e.id||null===(s=this.latest)||void 0===s||null===(i=s.post)||void 0===i||!i.id)&&this.current.post.id==this.latest.post.id}},methods:{toPublish:function(){var t=this;if(this.post.source_id)if(this.post.content)if(this.post.level>=1&&this.post.level<=5)if(this.post.remark){this.processing=!0;var e={source_id:String(this.post.source_id),level:this.post.level,user_nickname:l.a.getInfo().name,content:this.post.content,remark:this.post.remark};if(this.id){var s=Object(u.pick)(e,["level","content","remark"]);a.a.update(this.id,Object(i.a)(Object(i.a)({},s),{},{client:this.client})).then((function(e){e=e.data,t.$message({message:"提交成功，请等待审核",type:"success"}),setTimeout((function(){t.$router.push({name:"wiki_post",params:{type:"quest"}})}),500)})).finally((function(){t.processing=!1}))}else a.a.post(Object(i.a)(Object(i.a)({type:"quest"},e),{},{client:this.client}),{}).then((function(e){e=e.data,t.$message({message:"提交成功，请等待审核",type:"success"}),setTimeout((function(){t.$router.push({name:"wiki_post",params:{type:"quest"}})}),500)})).finally((function(){t.processing=!1}))}else this.$message({message:"请简单描述本次修订说明",type:"warning"});else this.$message({message:"请选择适合的综合难度",type:"warning"});else this.$message({message:"要编写攻略正文哦",type:"warning"});else this.$message({message:"请选择要修订攻略的任务",type:"warning"})},search_handle:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.loading=!0,c({keyword:e,per:10}).then((function(e){var s,i;t.options.sources=(null===(s=e.data)||void 0===s||null===(i=s.list)||void 0===i?void 0:i.byKeyword)||[],t.loading=!1}))},loadData:function(t){var e=this;this.loading=!0,a.a.get({type:"quest",id:this.post.source_id},{client:t}).then((function(t){var s=t.data,i=s.data.post,o=s.data.source;if(i){e.post.source_id=parseInt(i.source_id),e.post.level=i.level||1,e.post.remark=i.remark;var n=i.content;n=(n=(n=n.replace(/(<p>)?\s*◆任务难度 [★]+\s*(<\/p>)?/gi,"")).replace(/(<p>)?\s*◆花费时长 [★]+\s*(<\/p>)?/gi,"")).replace(/(<p>)?\s*◆任务攻略\s*(<\/p>)?/gi,""),e.post.content=n}else e.post.source_id=e.post.source_id?parseInt(e.post.source_id):"",e.post.level=0,e.post.remark="",e.post.content="";if(o){var a=!1;for(var l in e.options.sources=e.options.sources||[],e.options.sources)if(e.options.sources[l].id==o.QuestID){a=!0;break}a||(o.id=null==o?void 0:o.QuestID,o.name=null==o?void 0:o.QuestName,e.options.sources.push(o))}})).finally((function(){e.loading=!1}))},loadDataByPostId:function(){var t=this;this.loading=!0,a.a.getById(this.id).then((function(e){t.current=e.data.data;var s=e.data,i=s.data.post,o=s.data.source;if(i){t.post.source_id=parseInt(i.source_id),t.post.level=i.level||1,t.post.remark=i.remark;var n=i.content;n=(n=(n=n.replace(/(<p>)?\s*◆任务难度 [★]+\s*(<\/p>)?/gi,"")).replace(/(<p>)?\s*◆花费时长 [★]+\s*(<\/p>)?/gi,"")).replace(/(<p>)?\s*◆任务攻略\s*(<\/p>)?/gi,""),t.post.content=n}else t.post.source_id=t.post.source_id?parseInt(t.post.source_id):"",t.post.level=0,t.post.remark="",t.post.content="";if(o){var a=!1;for(var l in t.options.sources=t.options.sources||[],t.options.sources)if(t.options.sources[l].id==o.QuestID){a=!0;break}a||(o.id=null==o?void 0:o.QuestID,o.name=null==o?void 0:o.QuestName,t.options.sources.push(o))}})).finally((function(){t.loading=!1}))},loadLatest:function(){var t=this;this.post.source_id&&a.a.get({type:"quest",id:this.post.source_id}).then((function(e){t.latest=e.data.data}))},getLink:function(t){return Object(p.f)("quest",t)},getLatest:function(){var t;this.post.content=(null===(t=this.latest.post)||void 0===t?void 0:t.content)||""}},created:function(){this.search_handle("");var t=this.$route.params.source_id;this.post.source_id=t?parseInt(t):null,this.loadLatest()},watch:{"post.source_id":{handler:function(t){var e=this;t&&(this.id?this.loadDataByPostId():"std"==this.client?this.loadData("std"):this.loadData("origin").then((function(t){console.log("兼容获取"),t||e.loadData("std")})))}}},components:{"publish-header":o.a,Tinymce:n.a}},h=(s("dcaa"),s("2877")),m=Object(h.a)(d,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-box"},[e("publish-header",{attrs:{name:"任务百科"}},[t._t("header")],2),e("el-form",{staticClass:"m-publish-post"},[e("div",{staticClass:"m-publish-source"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("选择任务 *")]),e("el-select",{staticClass:"u-source-id",attrs:{filterable:"",remote:"",disabled:!!t.post.id,placeholder:"输入任务名称（可适配中括号形式）「回车」进行搜索","remote-method":t.search_handle,loading:t.options.loading},model:{value:t.post.source_id,callback:function(e){t.$set(t.post,"source_id",e)},expression:"post.source_id"}},t._l(t.options.sources,(function(s){return e("el-option",{key:s.id,attrs:{label:s.name,value:s.id}},[e("div",{staticClass:"m-selector-item"},[e("i",{staticClass:"el-icon-collection u-icon"}),e("span",{staticClass:"u-name",domProps:{textContent:t._s(s.name)}})])])})),1)],1),e("div",{staticClass:"m-publish-level"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("综合难度 *")]),e("el-rate",{staticClass:"u-level",model:{value:t.post.level,callback:function(e){t.$set(t.post,"level",e)},expression:"post.level"}})],1),e("div",{staticClass:"m-publish-remark"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("修订说明 *")]),e("el-input",{attrs:{maxlength:200,minlength:1,"show-word-limit":"",required:"",placeholder:"请简单描述一下本次修订的说明"},model:{value:t.post.remark,callback:function(e){t.$set(t.post,"remark",e)},expression:"post.remark"}})],1),e("div",{staticClass:"m-publish-content"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("攻略正文 *")]),e("Tinymce",{attrs:{attachmentEnable:!0,resourceEnable:!0,height:400},model:{value:t.post.content,callback:function(e){t.$set(t.post,"content",e)},expression:"post.content"}},[!t.isLatest&&t.latest.post&&t.current.post?e("el-alert",{staticClass:"m-latest-check",attrs:{type:"warning","show-icon":""},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{staticClass:"u-alert-title"},[t._v("当前百科已经有更新的版本，你的攻略可能已经失效，请先进行比对。")]),e("el-link",{staticClass:"u-view-latest",attrs:{type:"primary",icon:"el-icon-link",href:t.getLink(t.post.source_id),target:"_blank"}},[t._v("查看最新攻略")]),t.latest.post?e("el-link",{staticClass:"u-get-latest",attrs:{icon:"el-icon-download",type:"primary"},on:{click:t.getLatest}},[t._v("获取最新攻略")]):t._e()]},proxy:!0}],null,!1,2238318328)}):t._e()],1)],1),e("div",{staticClass:"m-publish-commit"},[e("el-divider",{attrs:{"content-position":"left"}}),e("el-button",{staticClass:"u-publish",attrs:{icon:"el-icon-s-promotion",type:"primary",disabled:t.processing},on:{click:t.toPublish}},[t._v("提交攻略")])],1)])],1)}),[],!1,null,"22a8defe",null);e.default=m.exports},b3aa:function(t,e,s){},b4e5:function(t,e,s){"use strict";s("b3aa")},dcaa:function(t,e,s){"use strict";s("7924")},ef77:function(t,e,s){"use strict";s("b0c0"),s("14d9");var i={name:"publish_header",props:["name"],data:function(){return{}},computed:{},methods:{goBack:function(){window.history.length?this.$router.go(-1):this.$router.push("/")}},mounted:function(){},components:{}},o=(s("b4e5"),s("2877")),n=Object(o.a)(i,(function(){var t=this._self._c;return t("div",{staticClass:"m-publish-header"},[t("el-page-header",{attrs:{content:this.name},on:{back:this.goBack}}),this._t("default")],2)}),[],!1,null,null,null);e.a=n.exports}}]);
//# sourceMappingURL=chunk-17073475.1877bba3.js.map